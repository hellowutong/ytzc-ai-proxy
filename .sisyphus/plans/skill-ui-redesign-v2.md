# Skill 管理 UI 重新设计方案

## 架构理解

基于 `skills/` 目录结构：
```
skills/
├── system/
│   └── router/
│       └── v1/
│           ├── 关键词路由/
│           │   └── SKILL.md
│           └── 意图识别/
│               └── SKILL.md
├── custom/
│   └── router/
│       ├── v1/
│       │   └── 我的路由/
│       │       └── SKILL.md
│       └── v2/
│           └── 优化版路由/
│               └── SKILL.md
```

**关键理解**：
- 每个分类（router/knowledge等）下可以有**多个Skill**
- 每个Skill有**系统版本**（只读）和**自定义版本**（可增删改）
- 系统版本和自定义版本是独立的

---

## 新 UI 设计方案

### 整体布局

```
┌──────────────────────────────────────────────────────────────────────┐
│  Skill管理                                                             │
├──────────────┬───────────────────────────────────────────────────────┤
│              │  ▼ router (模型路由)                        [重载全部] │
│  ▼ Skill分类 │                                                       │
│    ▼ router  │  ┌─────────────────────────────────────────────────┐  │
│    ├─ know.. │  │  系统默认 Skills                                │  │
│    ├─ web..  │  │                                                 │  │
│    ...       │  │  ┌─────────────┐    ┌─────────────┐             │  │
│              │  │  │ 关键词路由   │    │ 意图识别     │             │  │
│              │  │  │             │    │             │             │  │
│              │  │  │ 版本: v1    │    │ 版本: v1    │             │  │
│              │  │  │ [查看]      │    │ [查看]      │             │  │
│              │  │  └─────────────┘    └─────────────┘             │  │
│              │  └─────────────────────────────────────────────────┘  │
│              │                                                       │  │
│              │  ┌─────────────────────────────────────────────────┐  │
│              │  │  自定义 Skills                          [+ 新增] │  │
│              │  │                                                 │  │
│              │  │  ┌─────────────┐    ┌─────────────┐             │  │
│              │  │  │ X_skill     │    │ Y_skill     │             │  │
│              │  │  │             │    │             │             │  │
│              │  │  │ 版本: v1 ▼  │    │ 版本: v2 ▼  │             │  │
│              │  │  │ [查看][编辑]│    │ [查看][编辑]│             │  │
│              │  │  │ [删除Skill] │    │ [删除Skill] │             │  │
│              │  │  └─────────────┘    └─────────────┘             │  │
│              │  │                                                 │  │
│              │  │  ┌─────────────┐                               │  │
│              │  │  │ Z_skill     │                               │  │
│              │  │  │             │                               │  │
│              │  │  │ 版本: v3 ▼  │                               │  │
│              │  │  │ [查看][编辑]│                               │  │
│              │  │  │ [删除Skill] │                               │  │
│              │  │  └─────────────┘                               │  │
│              │  └─────────────────────────────────────────────────┘  │
│              │                                                       │  │
│              │  [保存配置]                                           │  │
└──────────────┴───────────────────────────────────────────────────────┘
```

---

### 详细设计

#### 1. 左侧分类树（保持不变）

```
▼ Skill分类
  ▼ virtual_models (虚拟模型)
    ├─ router (模型路由)
    ├─ knowledge (知识库)
    └─ web_search (联网搜索)
  ├─ knowledge (知识提取)
  ├─ rss (RSS处理)
  ├─ audio (音频处理)
  ├─ video (视频处理)
  └─ text (文本处理)
```

#### 2. 右侧详情区 - 系统默认 Skills

**特性**：
- 只读，不可编辑
- 显示该分类下所有系统默认Skill
- 每个Skill卡片显示：
  - Skill名称
  - 当前版本（下拉选择 v1/v2/v3）
  - [查看] 按钮（只读查看SKILL.md）

**Skill卡片**：
```
┌─────────────────┐
│ 关键词路由       │
│                 │
│ 版本: [v1    ▼] │
│                 │
│    [查看]       │
└─────────────────┘
```

#### 3. 右侧详情区 - 自定义 Skills

**特性**：
- 可增删改
- 显示该分类下所有自定义Skill
- 右上角 [+ 新增] 按钮
- 每个Skill卡片显示：
  - Skill名称（可编辑）
  - 版本选择（该Skill的所有版本）
  - [查看] [编辑] 按钮
  - [删除Skill] 按钮（删除整个Skill及其所有版本）

**Skill卡片**：
```
┌─────────────────┐
│ X_skill      ✏️ │  ← 点击名称可编辑
│                 │
│ 版本: [v1    ▼] │  ← 选择该Skill的版本
│                 │
│ [查看] [编辑]   │
│ [删除Skill]     │
└─────────────────┘
```

#### 4. 新增自定义 Skill 对话框

```
┌─────────────────────────────────────┐
│ 新增自定义 Skill                     │
├─────────────────────────────────────┤
│                                     │
│ Skill名称: [                      ] │
│           如: MyRouter, 优化版路由   │
│                                     │
│ 初始版本: [v1                     ] │
│                                     │
│ 复制来源:                            │
│   ○ 空白创建                         │
│   ● 系统默认 v1 (关键词路由)         │
│   ○ 系统默认 v1 (意图识别)           │
│   ○ 其他自定义 Skill...              │
│                                     │
│              [取消]  [创建]          │
└─────────────────────────────────────┘
```

#### 5. 版本管理（针对单个自定义Skill）

**版本下拉菜单**：
```
版本: [v2 ▼]
      ├─ v1 (2024-01-15)
      ├─ v2 (当前)
      ├─ v3 (2024-02-01)
      ├─ ─────────────
      └─ + 新增版本
```

**新增版本对话框**：
```
┌─────────────────────────────────────┐
│ 新增版本 - X_skill                   │
├─────────────────────────────────────┤
│                                     │
│ 新版本号: [v3                     ] │
│                                     │
│ 复制来源:                            │
│   ● 当前版本 v2                      │
│   ○ v1                               │
│   ○ 空白创建                         │
│                                     │
│              [取消]  [创建]          │
└─────────────────────────────────────┘
```

#### 6. 编辑 Skill 界面（含校验功能）

**点击 [编辑] 按钮后**：
```
┌──────────────────────────────────────────────────────┐
│ 编辑 Skill: X_skill (v2)                    [保存]   │
├──────────────────────────────────────────────────────┤
│                                                      │
│ 基本信息:                                            │
│   Skill名称: [X_skill                    ]          │
│   当前版本: v2                                      │
│                                                      │
│ SKILL.md 内容:                                       │
│   ┌────────────────────────────────────────────┐    │
│   │ ---                                       │    │
│   │ name: X_skill                             │    │
│   │ version: "2.0.0"                          │    │
│   │ ...                                       │    │
│   │ ---                                       │    │
│   │ # 我的自定义路由逻辑                       │    │
│   │ ...                                       │    │
│   └────────────────────────────────────────────┘    │
│                                                      │
│ 校验状态: ✅ 已通过校验                             │
│                                                      │
│ [✓ 校验] [💾 保存] [❌ 取消]                        │
│                                                      │
│ 版本管理:                                            │
│   当前: v2                                          │
│   所有版本: v1, v2, v3                              │
│   [切换版本] [删除此版本] [新增版本]                 │
│                                                      │
└──────────────────────────────────────────────────────┘
```

#### 7. 校验功能详细设计

**[✓ 校验] 按钮**：
- 点击后对当前编辑的 SKILL.md 进行完整校验
- 校验内容包括：
  1. **YAML Frontmatter 格式**：
     - `name` 字段是否存在且不为空
     - `version` 字段是否符合语义化版本规范
     - `type` 字段是否为有效值 (rule-based/llm-based/hybrid)
     - `input_schema` 和 `output_schema` 是否为有效的 JSON Schema
  
  2. **语法检查**：
     - YAML 语法是否正确
     - Markdown 内容是否完整
  
  3. **逻辑检查**：
     - Skill 名称是否与文件路径匹配
     - 引用的其他 Skill 是否存在

**校验结果展示**：
```
┌─────────────────────────────────────────────────────┐
│ 校验结果                                              │
├─────────────────────────────────────────────────────┤
│ ✅ YAML Frontmatter 格式正确                         │
│ ✅ 必填字段完整                                       │
│ ⚠️ 警告: input_schema 中缺少 description 字段       │
│ ❌ 错误: output_schema 中的 type 值无效              │
│                                                      │
│ 详细错误:                                            │
│ Line 15: output_schema.properties.result.type = "int"│
│          应为 "integer" 或 "string" 等有效类型       │
│                                                      │
│               [关闭]  [定位到错误行]                  │
└─────────────────────────────────────────────────────┘
```

**强制校验机制**：
- [保存] 按钮默认禁用，必须通过校验后才能点击
- 编辑器内容发生变化后，校验状态自动变为 "待校验"，[保存] 再次禁用
- 校验通过后，[保存] 按钮变为可用状态

**校验状态指示器**：
```
🔍 待校验    → 未进行校验或内容已修改
✅ 已通过    → 校验通过，可以保存
❌ 有错误    → 存在错误，需修复后才能保存
⚠️ 有警告    → 可以通过，但建议修复警告
```

**自动校验选项**（可选功能）：
```
☑️ 自动校验（每5秒自动校验一次）
☑️ 保存时强制校验（未通过校验禁止保存）
```

---

### 与 config_template.yml 对应

**系统默认**：
```yaml
knowledge:
  skill:
    enabled: true
    version: "v1"  # 对应 UI 中的版本选择
```

**自定义**：
```yaml
knowledge:
  skill:
    custom:
      enabled: true
      # 多个自定义Skill通过目录结构区分
      # custom/knowledge/v1/X_skill/
      # custom/knowledge/v2/Y_skill/
```

---

### 关键交互流程

#### 1. 查看系统默认 Skill
```
点击分类 → 显示系统Skills → 点击[查看] → 弹出只读编辑器
```

#### 2. 新增自定义 Skill
```
点击[+ 新增] → 填写名称/版本 → 选择复制来源 → [创建]
→ 自动打开编辑器 → 编辑内容 → [保存]
```

#### 3. 编辑自定义 Skill（含强制校验）
```
点击[编辑] → 打开编辑器
  ↓
修改内容/名称 → [✓ 校验]（必须步骤）
  ↓
校验通过 ✅ → [保存] 按钮变为可用 → 点击 [保存]
  ↓
询问：保存到当前版本 or 创建新版本

如果校验失败 ❌：
  → 显示错误详情 → 定位到错误行 → 修复 → 重新 [✓ 校验]
```

**强制校验规则**：
1. 打开编辑器时，[保存] 按钮默认禁用
2. 必须点击 [✓ 校验] 并通过后，[保存] 才能点击
3. 编辑器内容发生任何修改后，校验状态重置为 "待校验"，[保存] 再次禁用
4. 只有通过校验的内容才能被保存

#### 4. 切换版本
```
点击版本下拉 → 选择其他版本 → 自动加载该版本内容
→ 点击[编辑]可修改 → [保存]
```

#### 5. 删除自定义 Skill
```
点击[删除Skill] → 确认对话框 → 删除整个Skill（所有版本）
```

---

### 审核要点

请确认：

1. **系统默认Skills区域**：
   - 显示该分类下所有系统Skill
   - 每个Skill独立卡片，可选择版本
   - 只读，只能查看不能编辑

2. **自定义Skills区域**：
   - 显示该分类下所有自定义Skill（X_skill, Y_skill等）
   - 每个Skill独立卡片，有自己的版本管理
   - 可新增、编辑、删除整个Skill
   - 可新增、切换、删除单个版本

3. **版本管理**：
   - 每个自定义Skill有自己的版本历史（v1, v2, v3...）
   - 版本之间可以切换
   - 可以基于现有版本创建新版本

4. **命名空间**：
   - 不同分类下的Skill可以重名
   - 同一分类下的Skill名称必须唯一

5. **校验功能**（新增）：
   - [✓ 校验] 按钮在编辑器工具栏
   - 强制校验机制：必须通过校验才能保存
   - 校验内容包括：YAML格式、必填字段、JSON Schema、语法
   - 校验结果显示：✅通过/❌错误/⚠️警告
   - 支持错误定位（点击跳转到错误行）
   - 内容修改后自动重置校验状态

**请回复您的意见**：
- 这个设计是否满足"多个自定义Skill，每个多个版本"的需求？
- 系统默认和自定义的区分是否清晰？
- 校验功能设计是否完善？强制校验机制是否合理？
- 交互流程是否顺畅？
- 需要调整哪些部分？
