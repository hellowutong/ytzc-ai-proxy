import{d as te,l as c,c as N,a as B,F as X,r as H,e as $,w as s,n as i,t as h,g as ue,u as b,i as y,z as ve,k as p,_ as oe,Q as fe,j as se,b as e,f as j,R as _e,S as ge,T as be,U as ye,V as ke,W as we,D as ae,q as ne,X as Z,E as v,o as Ve,O as xe,P as $e,p as he,Y as Ue,Z as Se,$ as de}from"./index-DgeW9NR8.js";import{u as Ce}from"./models-CjJxZ9ep.js";const Te={class:"keyword-tag-input"},Me={class:"tags-container"},Ke={class:"counter"},Pe=te({__name:"KeywordTagInput",props:{modelValue:{},placeholder:{},maxTags:{}},emits:["update:modelValue"],setup(F,{emit:M}){const K=F,E=M,V=y(!1),_=y(""),P=y(),D=K.maxTags||50,a=()=>{V.value=!0,ve(()=>{var k;(k=P.value)==null||k.focus()})},O=()=>{const k=_.value.trim();if(!k){V.value=!1,_.value="";return}if(K.modelValue.includes(k)){V.value=!1,_.value="";return}if(K.modelValue.length>=D){V.value=!1,_.value="";return}const S=[...K.modelValue,k];E("update:modelValue",S),V.value=!1,_.value=""},U=k=>{const S=[...K.modelValue];S.splice(k,1),E("update:modelValue",S)};return(k,S)=>{const Q=p("el-tag"),q=p("el-input"),J=p("el-button");return c(),N("div",Te,[B("div",Me,[(c(!0),N(X,null,H(F.modelValue,(w,A)=>(c(),$(Q,{key:w+A,closable:"",onClose:W=>U(A),class:"keyword-tag",size:"default"},{default:s(()=>[i(h(w),1)]),_:2},1032,["onClose"]))),128)),V.value?(c(),$(q,{key:0,ref_key:"inputRef",ref:P,modelValue:_.value,"onUpdate:modelValue":S[0]||(S[0]=w=>_.value=w),size:"small",class:"tag-input",onKeyup:[ue(O,["enter"]),S[1]||(S[1]=ue(w=>V.value=!1,["escape"]))],onBlur:O},null,8,["modelValue"])):(c(),$(J,{key:1,class:"button-new-tag",size:"small",onClick:a,disabled:F.modelValue.length>=b(D)},{default:s(()=>[i(" + "+h(F.placeholder||"添加关键词"),1)]),_:1},8,["disabled"]))]),B("div",Ke," 已添加 "+h(F.modelValue.length)+"/"+h(b(D))+" 个关键词 ",1)])}}}),re=oe(Pe,[["__scopeId","data-v-22fb2dd3"]]),Be={key:0,class:"name-change-warning"},Re={class:"proxy-key-row"},ze={class:"model-switch-row"},Ee={class:"skill-toggle-row"},Ie={class:"skill-toggle-row"},Ne={class:"dialog-footer"},Ae=te({__name:"ModelDialog",props:{modelValue:{type:Boolean},model:{}},emits:["update:modelValue","submit"],setup(F,{emit:M}){const K=F,E=M,V=se({get:()=>K.modelValue,set:d=>E("update:modelValue",d)}),_=se(()=>!!K.model),P=y(""),D={name:"",proxy_key:"",base_url:"",current:"small",force_current:!1,stream_support:!0,use:!0,small:{model:"",api_key:"",base_url:""},big:{model:"",api_key:"",base_url:""},knowledge:{enabled:!0,shared:!1,system_default_skill:null,custom_skill:null,use_system_default:!0,use_custom:!1},web_search:{enabled:!1,system_default_skill:null,custom_skill:null,use_system_default:!0,use_custom:!1,targets:["searxng"]},keyword_switching:{enabled:!1,small_keywords:[],big_keywords:[]}},a=y({...D}),O=y({small:!1,big:!1}),U=y({}),k=y(!1),S=y([]),Q=y([]),q=y([]),J=y([]),w=y({knowledge_system:!1,knowledge_custom:!1,websearch_system:!1,websearch_custom:!1}),A=async(d,l=!1)=>{const C=l?"custom":"system",x=l?d==="knowledge"?"knowledge_custom":"websearch_custom":d==="knowledge"?"knowledge_system":"websearch_system";w.value[x]=!0;try{const r=await(await fetch(`/admin/ai/v1/skills/versions?category=${d}&skill_type=${C}`)).json();if(r.code===200&&r.data){const n=r.data.versions||[];d==="knowledge"?l?Q.value=n:S.value=n:d==="web_search"&&(l?J.value=n:q.value=n)}}catch(T){console.error(`获取${d} ${l?"自定义":"系统"}Skill版本失败:`,T)}finally{w.value[x]=!1}},W=async()=>{await A("knowledge",!1),await A("knowledge",!0),await A("web_search",!1),await A("web_search",!0)},o=d=>!d||d.length<=8?"****":d.slice(0,4)+"****"+d.slice(-4),u=()=>{k.value=!k.value};function m(){const d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="sk-";for(let C=0;C<32;C++)l+=d.charAt(Math.floor(Math.random()*d.length));return l}fe(()=>K.model,async d=>{d?(a.value={...D,...JSON.parse(JSON.stringify(d))},P.value=d.name||"",a.value.proxy_key||(a.value.proxy_key=m())):(a.value={...D,proxy_key:m()},P.value=""),await W()},{immediate:!0});const f=()=>{a.value.proxy_key=m(),v.success("Proxy Key 已生成")},R=()=>{if(!a.value.proxy_key){v.warning("Proxy Key 为空");return}navigator.clipboard.writeText(a.value.proxy_key).then(()=>v.success("Proxy Key 已复制")).catch(()=>v.error("复制失败"))},I=async d=>{var C,x;const l=a.value[d];if(!l.model||!l.api_key||!l.base_url){v.warning("请填写完整的模型配置信息");return}O.value[d]=!0,U.value[d]=null;try{const T=await fetch(`${l.base_url}/models`,{method:"GET",headers:{Authorization:`Bearer ${l.api_key}`,"Content-Type":"application/json"}});if(T.ok)((await T.json()).data||[]).some(z=>z.id===l.model||z.model===l.model)?(U.value[d]={status:"success",message:"连接成功，模型可用"},v.success(`${d==="small"?"小":"大"}模型连接成功`)):(U.value[d]={status:"success",message:"连接成功，但模型不在列表中"},v.warning(`${d==="small"?"小":"大"}模型连接成功，但找不到指定模型`));else{const r=await T.json().catch(()=>({}));U.value[d]={status:"error",message:`连接失败: ${((C=r.error)==null?void 0:C.message)||T.statusText}`},v.error(`${d==="small"?"小":"大"}模型连接失败: ${((x=r.error)==null?void 0:x.message)||T.statusText}`)}}catch(T){U.value[d]={status:"error",message:`连接错误: ${T.message}`},v.error(`${d==="small"?"小":"大"}模型连接错误: ${T.message}`)}finally{O.value[d]=!1}},ee=async()=>{await I("small"),await I("big")},Y=()=>{if(!a.value.name){v.warning("请输入虚拟模型名称");return}if(!a.value.proxy_key){v.warning("请生成Proxy Key");return}_.value&&P.value?E("submit",{...a.value},P.value):E("submit",{...a.value})};return(d,l)=>{const C=p("el-divider"),x=p("el-input"),T=p("el-alert"),r=p("el-form-item"),n=p("el-icon"),g=p("el-button"),z=p("el-switch"),L=p("el-radio-button"),G=p("el-radio-group"),ie=p("el-tag"),le=p("el-checkbox"),me=p("el-checkbox-group"),ce=p("el-form"),pe=p("el-dialog");return c(),$(pe,{modelValue:V.value,"onUpdate:modelValue":l[28]||(l[28]=t=>V.value=t),title:_.value?"编辑模型":"添加模型",width:"700px","destroy-on-close":"",class:"vscode-theme-dialog"},{footer:s(()=>[B("div",Ne,[e(g,{onClick:l[27]||(l[27]=t=>V.value=!1),class:"vscode-button"},{default:s(()=>[...l[48]||(l[48]=[i("取消",-1)])]),_:1}),e(g,{onClick:ee,class:"vscode-button"},{default:s(()=>[...l[49]||(l[49]=[i("测试所有连接",-1)])]),_:1}),e(g,{type:"primary",onClick:Y,class:"vscode-button-primary"},{default:s(()=>[...l[50]||(l[50]=[i("保存",-1)])]),_:1})])]),default:s(()=>[e(ce,{model:a.value,"label-width":"140px",class:"vscode-form"},{default:s(()=>[e(C,{"content-position":"left",class:"vscode-divider"},{default:s(()=>[...l[29]||(l[29]=[i("基础信息",-1)])]),_:1}),e(r,{label:"虚拟模型名称",required:""},{default:s(()=>[e(x,{modelValue:a.value.name,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value.name=t),placeholder:"如: demo1",class:"vscode-input"},null,8,["modelValue"]),_.value&&a.value.name!==P.value?(c(),N("div",Be,[e(T,{type:"warning",closable:!1,"show-icon":""},{title:s(()=>[i(' 模型名称将从 "'+h(P.value)+'" 修改为 "'+h(a.value.name)+'" ',1)]),_:1})])):j("",!0)]),_:1}),e(r,{label:"Proxy Key",required:""},{default:s(()=>[B("div",Re,[e(x,{"model-value":k.value?a.value.proxy_key:o(a.value.proxy_key),placeholder:"sk-xxxxxxxxxxxxxxxx",readonly:"",class:"vscode-input proxy-key-input"},{suffix:s(()=>[e(g,{link:"",onClick:u,class:"view-btn"},{default:s(()=>[k.value?(c(),$(n,{key:0},{default:s(()=>[e(b(_e))]),_:1})):(c(),$(n,{key:1},{default:s(()=>[e(b(ge))]),_:1}))]),_:1}),e(g,{link:"",onClick:R,class:"copy-btn"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(be))]),_:1})]),_:1})]),_:1},8,["model-value"]),e(g,{type:"primary",onClick:f,class:"generate-btn"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(ye))]),_:1}),l[30]||(l[30]=i(" 生成 ",-1))]),_:1})])]),_:1}),e(r,{label:"Base URL"},{default:s(()=>[e(x,{modelValue:a.value.base_url,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.base_url=t),placeholder:"https://api.example.com/v1",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,{label:"启用状态"},{default:s(()=>[e(z,{modelValue:a.value.use,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.use=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(r,{label:"关键字模型切换"},{default:s(()=>[e(z,{modelValue:a.value.keyword_switching.enabled,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.keyword_switching.enabled=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),a.value.keyword_switching.enabled?(c(),N(X,{key:0},[e(r,{label:"小模型关键词"},{default:s(()=>[e(re,{modelValue:a.value.keyword_switching.small_keywords,"onUpdate:modelValue":l[4]||(l[4]=t=>a.value.keyword_switching.small_keywords=t),placeholder:"添加关键词","max-tags":50},null,8,["modelValue"])]),_:1}),e(r,{label:"大模型关键词"},{default:s(()=>[e(re,{modelValue:a.value.keyword_switching.big_keywords,"onUpdate:modelValue":l[5]||(l[5]=t=>a.value.keyword_switching.big_keywords=t),placeholder:"添加关键词","max-tags":50},null,8,["modelValue"])]),_:1})],64)):j("",!0),e(r,{label:"当前模型"},{default:s(()=>[B("div",ze,[e(G,{modelValue:a.value.current,"onUpdate:modelValue":l[6]||(l[6]=t=>a.value.current=t),class:"model-switch-group"},{default:s(()=>[e(L,{label:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(ke))]),_:1}),l[31]||(l[31]=i(" 小模型 ",-1))]),_:1}),e(L,{label:"big"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(we))]),_:1}),l[32]||(l[32]=i(" 大模型 ",-1))]),_:1})]),_:1},8,["modelValue"]),e(ie,{type:a.value.current==="small"?"success":"warning",class:"current-model-tag"},{default:s(()=>[i(h(a.value.current==="small"?a.value.small.model||"未配置":a.value.big.model||"未配置"),1)]),_:1},8,["type"])])]),_:1}),e(r,{label:"强制使用"},{default:s(()=>[e(z,{modelValue:a.value.force_current,"onUpdate:modelValue":l[7]||(l[7]=t=>a.value.force_current=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(r,{label:"流式支持"},{default:s(()=>[e(z,{modelValue:a.value.stream_support,"onUpdate:modelValue":l[8]||(l[8]=t=>a.value.stream_support=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(C,{"content-position":"left",class:"vscode-divider"},{default:s(()=>[...l[33]||(l[33]=[i("小模型配置",-1)])]),_:1}),e(r,{label:"模型名称"},{default:s(()=>[e(x,{modelValue:a.value.small.model,"onUpdate:modelValue":l[9]||(l[9]=t=>a.value.small.model=t),placeholder:"如: deepseek-ai/DeepSeek-R1",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,{label:"API Key"},{default:s(()=>[e(x,{modelValue:a.value.small.api_key,"onUpdate:modelValue":l[10]||(l[10]=t=>a.value.small.api_key=t),type:"password",placeholder:"sk-xxx",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,{label:"Base URL"},{default:s(()=>[e(x,{modelValue:a.value.small.base_url,"onUpdate:modelValue":l[11]||(l[11]=t=>a.value.small.base_url=t),placeholder:"https://api.xxx.com/v1",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,null,{default:s(()=>[e(g,{onClick:l[12]||(l[12]=t=>I("small")),loading:O.value.small,class:"vscode-button"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(ae))]),_:1}),l[34]||(l[34]=i(" 测试连接 ",-1))]),_:1},8,["loading"]),U.value.small?(c(),N("span",{key:0,class:ne(["test-result",U.value.small.status])},h(U.value.small.message),3)):j("",!0)]),_:1}),e(C,{"content-position":"left",class:"vscode-divider"},{default:s(()=>[...l[35]||(l[35]=[i("大模型配置",-1)])]),_:1}),e(r,{label:"模型名称"},{default:s(()=>[e(x,{modelValue:a.value.big.model,"onUpdate:modelValue":l[13]||(l[13]=t=>a.value.big.model=t),placeholder:"如: Qwen/Qwen2.5-72B-Instruct",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,{label:"API Key"},{default:s(()=>[e(x,{modelValue:a.value.big.api_key,"onUpdate:modelValue":l[14]||(l[14]=t=>a.value.big.api_key=t),type:"password",placeholder:"sk-xxx",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,{label:"Base URL"},{default:s(()=>[e(x,{modelValue:a.value.big.base_url,"onUpdate:modelValue":l[15]||(l[15]=t=>a.value.big.base_url=t),placeholder:"https://api.xxx.com/v1",class:"vscode-input"},null,8,["modelValue"])]),_:1}),e(r,null,{default:s(()=>[e(g,{onClick:l[16]||(l[16]=t=>I("big")),loading:O.value.big,class:"vscode-button"},{default:s(()=>[e(n,null,{default:s(()=>[e(b(ae))]),_:1}),l[36]||(l[36]=i(" 测试连接 ",-1))]),_:1},8,["loading"]),U.value.big?(c(),N("span",{key:0,class:ne(["test-result",U.value.big.status])},h(U.value.big.message),3)):j("",!0)]),_:1}),e(C,{"content-position":"left",class:"vscode-divider"},{default:s(()=>[...l[37]||(l[37]=[i("知识库配置",-1)])]),_:1}),e(r,{label:"启用知识库"},{default:s(()=>[e(z,{modelValue:a.value.knowledge.enabled,"onUpdate:modelValue":l[17]||(l[17]=t=>a.value.knowledge.enabled=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(r,{label:"共享知识库"},{default:s(()=>[e(z,{modelValue:a.value.knowledge.shared,"onUpdate:modelValue":l[18]||(l[18]=t=>a.value.knowledge.shared=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(r,{label:"系统默认Skill"},{default:s(()=>[e(G,{modelValue:a.value.knowledge.system_default_skill,"onUpdate:modelValue":l[19]||(l[19]=t=>a.value.knowledge.system_default_skill=t),class:"vscode-radio-group",loading:w.value.knowledge_system},{default:s(()=>[e(L,{label:""},{default:s(()=>[...l[38]||(l[38]=[i("不使用",-1)])]),_:1}),(c(!0),N(X,null,H(S.value,t=>(c(),$(L,{key:t,label:t},{default:s(()=>[i(" 系统默认 "+h(t),1)]),_:2},1032,["label"]))),128)),S.value.length===0&&!w.value.knowledge_system?(c(),$(b(Z),{key:0,description:"暂无可用版本","image-size":60})):j("",!0)]),_:1},8,["modelValue","loading"])]),_:1}),e(r,{label:"自定义Skill"},{default:s(()=>[B("div",Ee,[e(z,{modelValue:a.value.knowledge.use_custom,"onUpdate:modelValue":l[20]||(l[20]=t=>a.value.knowledge.use_custom=t),class:"vscode-switch"},null,8,["modelValue"]),l[39]||(l[39]=B("span",{class:"skill-toggle-label"},"启用自定义Skill",-1))])]),_:1}),a.value.knowledge.use_custom?(c(),$(r,{key:1,label:"自定义Skill版本"},{default:s(()=>[e(G,{modelValue:a.value.knowledge.custom_skill,"onUpdate:modelValue":l[21]||(l[21]=t=>a.value.knowledge.custom_skill=t),class:"vscode-radio-group",loading:w.value.knowledge_custom},{default:s(()=>[e(L,{label:""},{default:s(()=>[...l[40]||(l[40]=[i("不使用",-1)])]),_:1}),(c(!0),N(X,null,H(Q.value,t=>(c(),$(L,{key:t,label:t},{default:s(()=>[i(h(t),1)]),_:2},1032,["label"]))),128)),Q.value.length===0&&!w.value.knowledge_custom?(c(),$(b(Z),{key:0,description:"暂无可用版本","image-size":60})):j("",!0)]),_:1},8,["modelValue","loading"])]),_:1})):j("",!0),e(C,{"content-position":"left",class:"vscode-divider"},{default:s(()=>[...l[41]||(l[41]=[i("联网搜索配置",-1)])]),_:1}),e(r,{label:"启用联网搜索"},{default:s(()=>[e(z,{modelValue:a.value.web_search.enabled,"onUpdate:modelValue":l[22]||(l[22]=t=>a.value.web_search.enabled=t),class:"vscode-switch"},null,8,["modelValue"])]),_:1}),e(r,{label:"系统默认Skill"},{default:s(()=>[e(G,{modelValue:a.value.web_search.system_default_skill,"onUpdate:modelValue":l[23]||(l[23]=t=>a.value.web_search.system_default_skill=t),class:"vscode-radio-group",loading:w.value.websearch_system},{default:s(()=>[e(L,{label:""},{default:s(()=>[...l[42]||(l[42]=[i("不使用",-1)])]),_:1}),(c(!0),N(X,null,H(q.value,t=>(c(),$(L,{key:t,label:t},{default:s(()=>[i(" 系统默认 "+h(t),1)]),_:2},1032,["label"]))),128)),q.value.length===0&&!w.value.websearch_system?(c(),$(b(Z),{key:0,description:"暂无可用版本","image-size":60})):j("",!0)]),_:1},8,["modelValue","loading"])]),_:1}),e(r,{label:"自定义Skill"},{default:s(()=>[B("div",Ie,[e(z,{modelValue:a.value.web_search.use_custom,"onUpdate:modelValue":l[24]||(l[24]=t=>a.value.web_search.use_custom=t),class:"vscode-switch"},null,8,["modelValue"]),l[43]||(l[43]=B("span",{class:"skill-toggle-label"},"启用自定义Skill",-1))])]),_:1}),a.value.web_search.use_custom?(c(),$(r,{key:2,label:"自定义Skill版本"},{default:s(()=>[e(G,{modelValue:a.value.web_search.custom_skill,"onUpdate:modelValue":l[25]||(l[25]=t=>a.value.web_search.custom_skill=t),class:"vscode-radio-group",loading:w.value.websearch_custom},{default:s(()=>[e(L,{label:""},{default:s(()=>[...l[44]||(l[44]=[i("不使用",-1)])]),_:1}),(c(!0),N(X,null,H(J.value,t=>(c(),$(L,{key:t,label:t},{default:s(()=>[i(h(t),1)]),_:2},1032,["label"]))),128)),J.value.length===0&&!w.value.websearch_custom?(c(),$(b(Z),{key:0,description:"暂无可用版本","image-size":60})):j("",!0)]),_:1},8,["modelValue","loading"])]),_:1})):j("",!0),e(r,{label:"搜索目标"},{default:s(()=>[e(me,{modelValue:a.value.web_search.targets,"onUpdate:modelValue":l[26]||(l[26]=t=>a.value.web_search.targets=t),class:"vscode-checkbox-group"},{default:s(()=>[e(le,{label:"searxng"},{default:s(()=>[...l[45]||(l[45]=[i("SearXNG",-1)])]),_:1}),e(le,{label:"librex"},{default:s(()=>[...l[46]||(l[46]=[i("LibreX",-1)])]),_:1}),e(le,{label:"4get"},{default:s(()=>[...l[47]||(l[47]=[i("4get",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Le=oe(Ae,[["__scopeId","data-v-b8e8f6a4"]]),je={class:"virtual-models"},De={class:"toolbar"},Oe={class:"proxy-key-cell"},Fe={class:"current-model-cell"},Qe=te({__name:"VirtualModels",setup(F){const M=Ce(),K=y(""),E=y("all"),V=y(!1),_=y(null),P=y({}),D=y({}),a=se(()=>{let o=M.models;return K.value&&(o=o.filter(u=>u.name.toLowerCase().includes(K.value.toLowerCase()))),E.value!=="all"&&(o=o.filter(u=>E.value==="enabled"?u.use:!u.use)),o}),O=o=>o.length<=8?"****":o.slice(0,4)+"****"+o.slice(-4),U=o=>`http://localhost:8000/proxy/ai/v1/chat/completions?model=${o}`,k=async o=>{try{await navigator.clipboard.writeText(o),v.success("已复制到剪贴板")}catch{v.error("复制失败")}},S=async(o,u)=>{await M.updateModel(o.name,{use:u})?v.success(u?"模型已启用":"模型已禁用"):(o.use=!u,v.error("操作失败"))},Q=async o=>{const u=o.current==="small"?"big":"small";await M.switchModel(o.name,u)?v.success(`已切换到${u==="small"?"小":"大"}模型`):v.error("切换失败")},q=o=>{_.value={...o},V.value=!0},J=async o=>{try{await de.confirm(`确定要删除模型 "${o.name}" 吗？`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await M.deleteModel(o.name)?v.success("删除成功"):v.error("删除失败")}catch{}},w=async(o,u)=>{if(o.name&&M.models.some(R=>{var I;return R.name===o.name&&R.name!==(u||((I=_.value)==null?void 0:I.name))})){v.error(`模型名称 "${o.name}" 已存在，请使用其他名称`);return}let m;if(_.value){const f=u||_.value.name;m=await M.updateModel(f,o)}else{if(M.models.some(R=>R.name===o.name)){v.error(`模型名称 "${o.name}" 已存在，请使用其他名称`);return}m=await M.createModel(o)}m?(v.success(_.value?"更新成功":"创建成功"),V.value=!1,_.value=null):v.error(_.value?"更新失败":"创建失败")},A=async(o,u)=>{if(!o.model||!o.model.trim())return{success:!1,message:"模型名称未配置"};if(!o.base_url||!o.base_url.trim())return{success:!1,message:"Base URL未配置"};if(!o.api_key||!o.api_key.trim())return{success:!1,message:"API Key未配置"};try{const m=await fetch("/admin/ai/v1/models/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!m.ok){const R=await m.text();return{success:!1,message:`服务器错误 (${m.status}): ${R||"未知错误"}`}}const f=await m.json();return f.code===200?{success:!0,message:"连接成功"}:f.code===401?{success:!1,message:"API Key无效或已过期"}:f.code===400?{success:!1,message:`请求错误: ${f.message}`}:f.code===408||f.code===503?{success:!1,message:`连接问题: ${f.message}`}:{success:!1,message:f.message||`连接失败 (错误码: ${f.code})`}}catch(m){return console.error("模型连接测试失败:",m),m.name==="TypeError"&&m.message.includes("fetch")?{success:!1,message:"网络请求失败，请检查网络连接"}:{success:!1,message:`网络错误: ${m.message||"未知错误"}`}}},W=async o=>{P.value[o.name]=!0;try{v.info(`开始测试模型 "${o.name}"...`);const u=await A(o.small,"small"),m=await A(o.big,"big");D.value[o.name]={small:u.success,big:m.success,smallMsg:u.message,bigMsg:m.message};const f=u.success?"✅":"❌",R=m.success?"✅":"❌";await de.alert(`<div style="line-height: 1.8;">
        <p><strong>模型测试完成 - ${o.name}</strong></p>
        <p>${f} <strong>小模型</strong> (${o.small.model||"未配置"})</p>
        <p style="margin-left: 24px; color: ${u.success?"#67c23a":"#f56c6c"};">${u.message}</p>
        <p>${R} <strong>大模型</strong> (${o.big.model||"未配置"})</p>
        <p style="margin-left: 24px; color: ${m.success?"#67c23a":"#f56c6c"};">${m.message}</p>
      </div>`,"模型测试结果",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0,type:u.success&&m.success?"success":u.success||m.success?"warning":"error"})}catch(u){console.error("模型测试过程发生错误:",u),v.error(`测试过程发生错误: ${u.message||"未知错误"}`)}finally{P.value[o.name]=!1}};return Ve(()=>{M.fetchModels()}),(o,u)=>{const m=p("el-icon"),f=p("el-button"),R=p("el-input"),I=p("el-option"),ee=p("el-select"),Y=p("el-link"),d=p("el-table-column"),l=p("el-tag"),C=p("el-switch"),x=p("el-table"),T=p("el-card"),r=$e("loading");return c(),N("div",je,[B("div",De,[e(f,{type:"primary",onClick:u[0]||(u[0]=n=>V.value=!0)},{default:s(()=>[e(m,null,{default:s(()=>[e(b(he))]),_:1}),u[4]||(u[4]=i("添加模型 ",-1))]),_:1}),e(R,{modelValue:K.value,"onUpdate:modelValue":u[1]||(u[1]=n=>K.value=n),placeholder:"搜索模型名称",clearable:"",style:{width:"240px","margin-left":"12px"}},{prefix:s(()=>[e(m,null,{default:s(()=>[e(b(Ue))]),_:1})]),_:1},8,["modelValue"]),e(ee,{modelValue:E.value,"onUpdate:modelValue":u[2]||(u[2]=n=>E.value=n),placeholder:"状态筛选",style:{width:"120px","margin-left":"12px"}},{default:s(()=>[e(I,{label:"全部",value:"all"}),e(I,{label:"启用",value:"enabled"}),e(I,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),xe((c(),$(T,{class:"table-card"},{default:s(()=>[e(x,{data:a.value,style:{width:"100%"}},{default:s(()=>[e(d,{prop:"name",label:"名称",width:"150"},{default:s(({row:n})=>[e(Y,{type:"primary",onClick:g=>k(n.name)},{default:s(()=>[i(h(n.name),1)]),_:2},1032,["onClick"])]),_:1}),e(d,{prop:"proxy_key",label:"Proxy Key",width:"400"},{default:s(({row:n})=>[B("div",Oe,[B("span",null,h(O(n.proxy_key)),1),e(f,{link:"",onClick:g=>k(n.proxy_key)},{default:s(()=>[e(m,null,{default:s(()=>[e(b(Se))]),_:1})]),_:1},8,["onClick"])])]),_:1}),e(d,{label:"系统URL",width:"580"},{default:s(({row:n})=>[e(Y,{type:"info",onClick:g=>k(U(n.name))},{default:s(()=>[i(h(U(n.name)),1)]),_:2},1032,["onClick"])]),_:1}),e(d,{label:"当前模型",width:"260"},{default:s(({row:n})=>[B("div",Fe,[e(l,{type:n.current==="small"?"success":"warning"},{default:s(()=>[i(h(n.current==="small"?"小模型":"大模型"),1)]),_:2},1032,["type"]),e(f,{size:"small",onClick:g=>Q(n),disabled:n.force_current},{default:s(()=>[...u[5]||(u[5]=[i(" 切换 ",-1)])]),_:1},8,["onClick","disabled"])])]),_:1}),e(d,{label:"状态",width:"150"},{default:s(({row:n})=>[e(C,{modelValue:n.use,"onUpdate:modelValue":g=>n.use=g,onChange:g=>S(n,g)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(d,{label:"操作",width:"380",fixed:"right"},{default:s(({row:n})=>[e(f,{link:"",type:"primary",onClick:g=>q(n)},{default:s(()=>[...u[6]||(u[6]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(f,{link:"",type:"success",onClick:g=>W(n),loading:P.value[n.name]},{default:s(()=>[e(m,null,{default:s(()=>[e(b(ae))]),_:1}),u[7]||(u[7]=i("模型测试 ",-1))]),_:1},8,["onClick","loading"]),e(f,{link:"",type:"danger",onClick:g=>J(n)},{default:s(()=>[...u[8]||(u[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[r,b(M).loading]]),e(Le,{modelValue:V.value,"onUpdate:modelValue":u[3]||(u[3]=n=>V.value=n),model:_.value,onSubmit:w},null,8,["modelValue","model"])])}}}),Xe=oe(Qe,[["__scopeId","data-v-b0b7abe1"]]);export{Xe as default};
//# sourceMappingURL=VirtualModels-C_IMi6Cm.js.map
