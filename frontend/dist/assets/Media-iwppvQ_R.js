import{A as W,i as F,d as O,l as v,e as U,w as o,b as e,u as L,a1 as X,a as z,n as b,c as D,F as j,r as E,f as R,j as N,k as u,_ as I,o as Z,p as ee,t as T,a3 as le,Y as oe,O as ae,E as k,$ as te,P as se}from"./index-DgeW9NR8.js";const ne=W("media",()=>{const i=F([]),_=F(!1);async function c(f){_.value=!0;try{const t=f?`/admin/ai/v1/media?type=${f}`:"/admin/ai/v1/media",p=await(await fetch(t)).json();p.code===200&&(i.value=p.data.items)}catch(t){console.error("Failed to fetch media files:",t)}finally{_.value=!1}}async function g(f,t,n){try{const p=new FormData;return p.append("file",f),p.append("type",t),p.append("config",JSON.stringify(n)),(await(await fetch("/admin/ai/v1/media/upload",{method:"POST",body:p})).json()).code===200}catch(p){return console.error("Failed to upload media:",p),!1}}async function m(f,t,n){try{return(await(await fetch("/admin/ai/v1/media/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:f,type:t,config:n})})).json()).code===200}catch(p){return console.error("Failed to download media:",p),!1}}async function a(f){try{return(await(await fetch(`/admin/ai/v1/media/${f}`,{method:"DELETE"})).json()).code===200?(await c(),!0):!1}catch(t){return console.error("Failed to delete media:",t),!1}}async function y(f){try{return(await(await fetch(`/admin/ai/v1/media/${f}/reprocess`,{method:"POST"})).json()).code===200}catch(t){return console.error("Failed to reprocess media:",t),!1}}return{files:i,loading:_,fetchFiles:c,uploadFile:g,downloadFromUrl:m,deleteFile:a,reprocessFile:y}}),ue={class:"dialog-footer"},de=O({__name:"MediaUploadDialog",props:{modelValue:{type:Boolean},type:{},processors:{},models:{}},emits:["update:modelValue","upload"],setup(i,{emit:_}){const c=i,g=_,m=N({get:()=>c.modelValue,set:t=>g("update:modelValue",t)}),a=F({file:null,processor:c.processors[0]||"default",model:c.models[0]||"base",language:"zh",auto_process:!0}),y=t=>{a.value.file=t.raw},f=()=>{a.value.file&&(g("upload",{file:a.value.file,config:{processor:a.value.processor,model:a.value.model,language:a.value.language,auto_process:a.value.auto_process}}),a.value.file=null)};return(t,n)=>{const p=u("el-icon"),w=u("el-upload"),V=u("el-form-item"),x=u("el-option"),C=u("el-select"),$=u("el-switch"),S=u("el-form"),l=u("el-button"),s=u("el-dialog");return v(),U(s,{modelValue:m.value,"onUpdate:modelValue":n[5]||(n[5]=d=>m.value=d),title:"上传文件",width:"500px"},{footer:o(()=>[z("div",ue,[e(l,{onClick:n[4]||(n[4]=d=>m.value=!1)},{default:o(()=>[...n[7]||(n[7]=[b("取消",-1)])]),_:1}),e(l,{type:"primary",onClick:f,disabled:!a.value.file},{default:o(()=>[...n[8]||(n[8]=[b("开始上传",-1)])]),_:1},8,["disabled"])])]),default:o(()=>[e(S,{model:a.value,"label-width":"120px"},{default:o(()=>[e(V,{label:"选择文件"},{default:o(()=>[e(w,{ref:"uploadRef",drag:"",action:"#","auto-upload":!1,"on-change":y,limit:1,class:"upload-dragger"},{default:o(()=>[e(p,{class:"el-icon--upload"},{default:o(()=>[e(L(X))]),_:1}),n[6]||(n[6]=z("div",{class:"el-upload__text"},[b(" 拖拽文件到此处或 "),z("em",null,"点击上传")],-1))]),_:1},512)]),_:1}),i.processors.length>1?(v(),U(V,{key:0,label:"转录处理器"},{default:o(()=>[e(C,{modelValue:a.value.processor,"onUpdate:modelValue":n[0]||(n[0]=d=>a.value.processor=d)},{default:o(()=>[(v(!0),D(j,null,E(i.processors,d=>(v(),U(x,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):R("",!0),i.models.length?(v(),U(V,{key:1,label:"模型"},{default:o(()=>[e(C,{modelValue:a.value.model,"onUpdate:modelValue":n[1]||(n[1]=d=>a.value.model=d)},{default:o(()=>[(v(!0),D(j,null,E(i.models,d=>(v(),U(x,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):R("",!0),e(V,{label:"语言"},{default:o(()=>[e(C,{modelValue:a.value.language,"onUpdate:modelValue":n[2]||(n[2]=d=>a.value.language=d)},{default:o(()=>[e(x,{label:"中文",value:"zh"}),e(x,{label:"英文",value:"en"}),e(x,{label:"自动检测",value:"auto"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"自动转录"},{default:o(()=>[e($,{modelValue:a.value.auto_process,"onUpdate:modelValue":n[3]||(n[3]=d=>a.value.auto_process=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),re=I(de,[["__scopeId","data-v-2a6907e0"]]),ie={class:"dialog-footer"},pe=O({__name:"MediaUrlDialog",props:{modelValue:{type:Boolean},type:{},processors:{},models:{}},emits:["update:modelValue","download"],setup(i,{emit:_}){const c=i,g=_,m=N({get:()=>c.modelValue,set:f=>g("update:modelValue",f)}),a=F({url:"",processor:c.processors[0]||"default",model:c.models[0]||"base",language:"zh",auto_process:!0}),y=()=>{a.value.url&&(g("download",{url:a.value.url,config:{processor:a.value.processor,model:a.value.model,language:a.value.language,auto_process:a.value.auto_process}}),a.value.url="")};return(f,t)=>{const n=u("el-input"),p=u("el-form-item"),w=u("el-option"),V=u("el-select"),x=u("el-switch"),C=u("el-form"),$=u("el-button"),S=u("el-dialog");return v(),U(S,{modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=l=>m.value=l),title:"URL下载",width:"500px"},{footer:o(()=>[z("div",ie,[e($,{onClick:t[5]||(t[5]=l=>m.value=!1)},{default:o(()=>[...t[7]||(t[7]=[b("取消",-1)])]),_:1}),e($,{type:"primary",onClick:y,disabled:!a.value.url},{default:o(()=>[...t[8]||(t[8]=[b("开始下载",-1)])]),_:1},8,["disabled"])])]),default:o(()=>[e(C,{model:a.value,"label-width":"120px"},{default:o(()=>[e(p,{label:"视频URL",required:""},{default:o(()=>[e(n,{modelValue:a.value.url,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.url=l),placeholder:"https://example.com/video.mp4",type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),e(p,{label:"转录处理器"},{default:o(()=>[e(V,{modelValue:a.value.processor,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.processor=l)},{default:o(()=>[(v(!0),D(j,null,E(i.processors,l=>(v(),U(w,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"模型"},{default:o(()=>[e(V,{modelValue:a.value.model,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.model=l)},{default:o(()=>[(v(!0),D(j,null,E(i.models,l=>(v(),U(w,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"语言"},{default:o(()=>[e(V,{modelValue:a.value.language,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.language=l)},{default:o(()=>[e(w,{label:"中文",value:"zh"}),e(w,{label:"英文",value:"en"}),e(w,{label:"自动检测",value:"auto"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"自动转录"},{default:o(()=>[e(x,{modelValue:a.value.auto_process,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.auto_process=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ce=I(pe,[["__scopeId","data-v-5ea2dcaf"]]),me={class:"media-list"},fe={class:"toolbar"},_e=O({__name:"MediaList",props:{type:{},processors:{},models:{}},setup(i){const _=i,c=ne(),g=F(""),m=F("all"),a=F(!1),y=F(!1),f=N(()=>({video:"视频",audio:"音频",text:"文档"})[_.type]),t=N(()=>{let l=c.files.filter(s=>s.type===_.type);return g.value&&(l=l.filter(s=>s.filename.toLowerCase().includes(g.value.toLowerCase()))),m.value!=="all"&&(l=l.filter(s=>s.status===m.value)),l}),n=l=>{if(l===0)return"0 B";const s=1024,d=["B","KB","MB","GB"],h=Math.floor(Math.log(l)/Math.log(s));return parseFloat((l/Math.pow(s,h)).toFixed(2))+" "+d[h]},p=l=>({pending:"info",processing:"warning",completed:"success",failed:"danger"})[l]||"info",w=l=>({pending:"待处理",processing:"处理中",completed:"已完成",failed:"失败"})[l]||l,V=l=>{k.info(`查看: ${l.filename}`)},x=async l=>{await c.reprocessFile(l.id)?k.success("重新处理任务已提交"):k.error("操作失败")},C=async l=>{try{await te.confirm(`确定要删除 "${l.filename}" 吗？`,"确认删除"),await c.deleteFile(l.id)?k.success("删除成功"):k.error("删除失败")}catch{}},$=async l=>{await c.uploadFile(l.file,_.type,l.config)?(k.success("上传成功"),a.value=!1):k.error("上传失败")},S=async l=>{await c.downloadFromUrl(l.url,_.type,l.config)?(k.success("下载任务已提交"),y.value=!1):k.error("下载失败")};return Z(()=>{c.fetchFiles(_.type)}),(l,s)=>{const d=u("el-icon"),h=u("el-button"),q=u("el-input"),B=u("el-option"),A=u("el-select"),M=u("el-table-column"),G=u("el-tag"),K=u("el-progress"),Q=u("el-table"),Y=u("el-card"),H=se("loading");return v(),D("div",me,[z("div",fe,[e(h,{type:"primary",onClick:s[0]||(s[0]=r=>a.value=!0)},{default:o(()=>[e(d,null,{default:o(()=>[e(L(ee))]),_:1}),b("上传"+T(f.value),1)]),_:1}),i.type!=="text"?(v(),U(h,{key:0,onClick:s[1]||(s[1]=r=>y.value=!0)},{default:o(()=>[e(d,null,{default:o(()=>[e(L(le))]),_:1}),s[6]||(s[6]=b("URL下载 ",-1))]),_:1})):R("",!0),e(q,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=r=>g.value=r),placeholder:"搜索文件名",clearable:"",style:{width:"240px","margin-left":"12px"}},{prefix:o(()=>[e(d,null,{default:o(()=>[e(L(oe))]),_:1})]),_:1},8,["modelValue"]),e(A,{modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=r=>m.value=r),placeholder:"状态筛选",style:{width:"120px","margin-left":"12px"}},{default:o(()=>[e(B,{label:"全部",value:"all"}),e(B,{label:"待处理",value:"pending"}),e(B,{label:"处理中",value:"processing"}),e(B,{label:"已完成",value:"completed"}),e(B,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),ae((v(),U(Y,{class:"table-card"},{default:o(()=>[e(Q,{data:t.value,style:{width:"100%"}},{default:o(()=>[e(M,{prop:"filename",label:"文件名",width:"500"}),e(M,{prop:"size",label:"大小",width:"120"},{default:o(({row:r})=>[b(T(n(r.size)),1)]),_:1}),e(M,{prop:"status",label:"状态",width:"120"},{default:o(({row:r})=>[e(G,{type:p(r.status)},{default:o(()=>[b(T(w(r.status)),1)]),_:2},1032,["type"])]),_:1}),e(M,{label:"进度",width:"200"},{default:o(({row:r})=>[e(K,{percentage:r.progress,status:r.status==="failed"?"exception":void 0},null,8,["percentage","status"])]),_:1}),e(M,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:r})=>[b(T(new Date(r.created_at).toLocaleString("zh-CN")),1)]),_:1}),e(M,{label:"操作",width:"200",fixed:"right"},{default:o(({row:r})=>[e(h,{link:"",type:"primary",onClick:J=>V(r)},{default:o(()=>[...s[7]||(s[7]=[b("查看",-1)])]),_:1},8,["onClick"]),e(h,{link:"",type:"primary",onClick:J=>x(r)},{default:o(()=>[...s[8]||(s[8]=[b("重新处理",-1)])]),_:1},8,["onClick"]),e(h,{link:"",type:"danger",onClick:J=>C(r)},{default:o(()=>[...s[9]||(s[9]=[b("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[H,L(c).loading]]),e(re,{modelValue:a.value,"onUpdate:modelValue":s[4]||(s[4]=r=>a.value=r),type:i.type,processors:i.processors,models:i.models,onUpload:$},null,8,["modelValue","type","processors","models"]),e(ce,{modelValue:y.value,"onUpdate:modelValue":s[5]||(s[5]=r=>y.value=r),type:i.type,processors:i.processors,models:i.models,onDownload:S},null,8,["modelValue","type","processors","models"])])}}}),P=I(_e,[["__scopeId","data-v-7ed36e77"]]),ve={class:"media"},ge=O({__name:"Media",setup(i){const _=F("video");return(c,g)=>{const m=u("el-tab-pane"),a=u("el-tabs");return v(),D("div",ve,[e(a,{modelValue:_.value,"onUpdate:modelValue":g[0]||(g[0]=y=>_.value=y),type:"border-card",class:"media-tabs"},{default:o(()=>[e(m,{label:"视频处理",name:"video"},{default:o(()=>[e(P,{type:"video",processors:["whisper","faster_whisper","whisper_npu"],models:["base","small","medium","large"]})]),_:1}),e(m,{label:"音频处理",name:"audio"},{default:o(()=>[e(P,{type:"audio",processors:["whisper","faster_whisper","whisper_npu"],models:["base","small","medium","large"]})]),_:1}),e(m,{label:"文档处理",name:"text"},{default:o(()=>[e(P,{type:"text",processors:["default"],models:[]})]),_:1})]),_:1},8,["modelValue"])])}}}),ye=I(ge,[["__scopeId","data-v-52491710"]]);export{ye as default};
//# sourceMappingURL=Media-iwppvQ_R.js.map
