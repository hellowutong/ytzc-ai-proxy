import{d as A,o as J,c as g,a as d,b as s,w as o,i as w,j as E,k as r,l as m,u as V,Y as P,s as Q,n as v,t as i,O as R,e as Y,F as G,r as H,q as K,f as L,$ as S,E as b,P as W,_ as X}from"./index-DgeW9NR8.js";import{u as Z}from"./chat-CXlrgbd5.js";import"./models-CjJxZ9ep.js";const ee={class:"conversations"},te={class:"toolbar"},ae={class:"id-cell"},se={key:0,class:"conversation-detail"},oe={class:"detail-header"},ne={class:"messages-container"},le={class:"message-role"},ie={class:"message-content"},re={key:0,class:"message-time"},ce=A({__name:"Conversations",setup(de){const h=Z(),x=t=>{if(!t)return"";try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return t}},C=w(""),D=w([]),y=w(!1),u=w(null),p=w([]),N=E(()=>p.value.length>0),$=E(()=>{let t=h.conversations;return C.value&&(t=t.filter(e=>{var c;const n=C.value.toLowerCase();return e.id.toLowerCase().includes(n)||((c=e.messages)==null?void 0:c.some(f=>f.content.toLowerCase().includes(n)))})),t}),j=async t=>{try{const n=await(await fetch(`/admin/ai/v1/conversations/${t.id}`)).json();n.code===200&&n.data?u.value=n.data:u.value=t,y.value=!0}catch(e){console.error("获取对话详情失败:",e),u.value=t,y.value=!0}},B=async t=>{try{await S.confirm("确定要删除此对话吗？此操作不可恢复。","确认删除",{type:"warning"});const n=await(await fetch(`/admin/ai/v1/conversations/${t.id}`,{method:"DELETE"})).json();n.code===200?(await h.fetchConversations(),b.success("删除成功")):b.error(n.message||"删除失败")}catch{}},T=t=>{p.value=t},z=async()=>{const t=p.value.length;if(t!==0)try{await S.confirm(`确定要删除选中的 ${t} 个对话吗？此操作不可恢复。`,"确认批量删除",{type:"warning"});const e=p.value.map(f=>f.id),c=await(await fetch("/admin/ai/v1/conversations/batch",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e})})).json();c.code===200?(await h.fetchConversations(),b.success(c.message),p.value=[]):b.error(c.message||"删除失败")}catch{}};return J(()=>{h.fetchConversations()}),(t,e)=>{const n=r("el-icon"),c=r("el-input"),f=r("el-date-picker"),k=r("el-button"),_=r("el-table-column"),I=r("el-tag"),M=r("el-table"),U=r("el-card"),F=r("el-dialog"),O=W("loading");return m(),g("div",ee,[d("div",te,[s(c,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=a=>C.value=a),placeholder:"搜索会话内容",clearable:"",style:{width:"300px"}},{prefix:o(()=>[s(n,null,{default:o(()=>[s(V(P))]),_:1})]),_:1},8,["modelValue"]),s(f,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=a=>D.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"12px"}},null,8,["modelValue"]),s(k,{type:"danger",disabled:!N.value,onClick:z,style:{"margin-left":"12px"}},{default:o(()=>[s(n,null,{default:o(()=>[s(V(Q))]),_:1}),v(" 批量删除 ("+i(p.value.length)+") ",1)]),_:1},8,["disabled"])]),s(U,{class:"table-card"},{default:o(()=>[R((m(),Y(M,{data:$.value,style:{width:"100%"},onSelectionChange:T},{default:o(()=>[s(_,{type:"selection",width:"55"}),s(_,{prop:"id",label:"ID",width:"400"},{default:o(({row:a})=>[d("span",ae,i(a.id.slice(0,8))+"...",1)]),_:1}),s(_,{prop:"model",label:"使用模型",width:"150"}),s(_,{label:"消息数",width:"150"},{default:o(({row:a})=>[s(I,null,{default:o(()=>{var l;return[v(i(((l=a.messages)==null?void 0:l.length)||0),1)]}),_:2},1024)]),_:1}),s(_,{prop:"created_at",label:"创建时间",width:"230"},{default:o(({row:a})=>[v(i(x(a.created_at)),1)]),_:1}),s(_,{prop:"updated_at",label:"最后更新",width:"230"},{default:o(({row:a})=>[v(i(x(a.updated_at)),1)]),_:1}),s(_,{label:"操作",width:"350",fixed:"right","class-name":"operation-column"},{default:o(({row:a})=>[s(k,{link:"",type:"primary",onClick:l=>j(a)},{default:o(()=>[...e[3]||(e[3]=[v("查看",-1)])]),_:1},8,["onClick"]),s(k,{link:"",type:"danger",onClick:l=>B(a)},{default:o(()=>[...e[4]||(e[4]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,V(h).loading]])]),_:1}),s(F,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),title:"对话详情",width:"800px",class:"conversation-dialog"},{default:o(()=>{var a;return[u.value?(m(),g("div",se,[d("div",oe,[d("span",null,"模型: "+i(u.value.model),1),d("span",null,"消息数: "+i(((a=u.value.messages)==null?void 0:a.length)||0),1)]),d("div",ne,[(m(!0),g(G,null,H(u.value.messages,(l,q)=>(m(),g("div",{key:q,class:K(["message-item",l.role])},[d("div",le,i(l.role==="user"?"用户":"AI"),1),d("div",ie,i(l.content),1),l.timestamp?(m(),g("div",re,i(new Date(l.timestamp).toLocaleString("zh-CN")),1)):L("",!0)],2))),128))])])):L("",!0)]}),_:1},8,["modelValue"])])}}}),me=X(ce,[["__scopeId","data-v-ebfe9617"]]);export{me as default};
//# sourceMappingURL=Conversations-Cq8P0TJX.js.map
