import{A as G,i as w,d as q,Q as H,e as j,w as l,j as E,k as d,l as C,b as e,c as I,r as K,u as x,F as W,a as T,n as i,E as b,_ as J,o as X,O as A,f as Z,P as ee,p as te,a2 as le,Y as ae,t as $,$ as ne}from"./index-DgeW9NR8.js";import{u as oe}from"./models-CjJxZ9ep.js";const se=G("rss",()=>{const U=w([]),c=w([]),f=w(!1);async function m(){f.value=!0;try{const t=await(await fetch("/admin/ai/v1/rss/feeds")).json();t.code===200&&(U.value=t.data.items)}catch(s){console.error("Failed to fetch feeds:",s)}finally{f.value=!1}}async function g(s){try{const t=s?`/admin/ai/v1/rss/articles?feed_id=${s}`:"/admin/ai/v1/rss/articles",p=await(await fetch(t)).json();p.code===200&&(c.value=p.data.items)}catch(t){console.error("Failed to fetch articles:",t)}}async function v(s){try{return(await(await fetch("/admin/ai/v1/rss/feeds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()).code===200?(await m(),!0):!1}catch(t){return console.error("Failed to create feed:",t),!1}}async function k(s,t){try{return(await(await fetch(`/admin/ai/v1/rss/feeds/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()).code===200?(await m(),!0):!1}catch(_){return console.error("Failed to update feed:",_),!1}}async function S(s){try{return(await(await fetch(`/admin/ai/v1/rss/feeds/${s}`,{method:"DELETE"})).json()).code===200?(await m(),!0):!1}catch(t){return console.error("Failed to delete feed:",t),!1}}async function u(s){try{return(await(await fetch(`/admin/ai/v1/rss/feeds/${s}/fetch`,{method:"POST"})).json()).code===200}catch(t){return console.error("Failed to fetch feed:",t),!1}}async function L(s){try{const t=new FormData;return t.append("file",s),(await(await fetch("/admin/ai/v1/rss/import",{method:"POST",body:t})).json()).code===200?(await m(),!0):!1}catch(t){return console.error("Failed to import OPML:",t),!1}}return{feeds:U,articles:c,loading:f,fetchFeeds:m,fetchArticles:g,createFeed:v,updateFeed:k,deleteFeed:S,fetchFeedNow:u,importOPML:L}}),re={class:"dialog-footer"},ue=q({__name:"RSSFeedDialog",props:{modelValue:{type:Boolean},feed:{}},emits:["update:modelValue","submit"],setup(U,{emit:c}){const f=U,m=c,g=E({get:()=>f.modelValue,set:s=>m("update:modelValue",s)}),v=oe(),k=E(()=>!!f.feed),S={name:"",url:"",enabled:!0,update_interval:"1h",retention_days:30,permanent:!1,model:""},u=w({...S});H(()=>f.feed,s=>{s?u.value={name:s.name,url:s.url,enabled:s.enabled,update_interval:s.update_interval,retention_days:s.retention_days,permanent:s.permanent,model:s.model}:u.value={...S}},{immediate:!0});const L=()=>{if(!u.value.name||!u.value.url){b.warning("请填写必填项");return}m("submit",{...u.value})};return(s,t)=>{const _=d("el-input"),p=d("el-form-item"),D=d("el-switch"),V=d("el-option"),N=d("el-select"),R=d("el-input-number"),r=d("el-form"),a=d("el-button"),F=d("el-dialog");return C(),j(F,{modelValue:g.value,"onUpdate:modelValue":t[8]||(t[8]=o=>g.value=o),title:k.value?"编辑订阅":"添加订阅",width:"500px"},{footer:l(()=>[T("div",re,[e(a,{onClick:t[7]||(t[7]=o=>g.value=!1)},{default:l(()=>[...t[9]||(t[9]=[i("取消",-1)])]),_:1}),e(a,{type:"primary",onClick:L},{default:l(()=>[...t[10]||(t[10]=[i("保存",-1)])]),_:1})])]),default:l(()=>[e(r,{model:u.value,"label-width":"120px"},{default:l(()=>[e(p,{label:"订阅名称",required:""},{default:l(()=>[e(_,{modelValue:u.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value.name=o),placeholder:"如: 技术新闻"},null,8,["modelValue"])]),_:1}),e(p,{label:"RSS URL",required:""},{default:l(()=>[e(_,{modelValue:u.value.url,"onUpdate:modelValue":t[1]||(t[1]=o=>u.value.url=o),placeholder:"https://example.com/feed.xml"},null,8,["modelValue"])]),_:1}),e(p,{label:"启用状态"},{default:l(()=>[e(D,{modelValue:u.value.enabled,"onUpdate:modelValue":t[2]||(t[2]=o=>u.value.enabled=o)},null,8,["modelValue"])]),_:1}),e(p,{label:"更新频率"},{default:l(()=>[e(N,{modelValue:u.value.update_interval,"onUpdate:modelValue":t[3]||(t[3]=o=>u.value.update_interval=o)},{default:l(()=>[e(V,{label:"30分钟",value:"30m"}),e(V,{label:"1小时",value:"1h"}),e(V,{label:"6小时",value:"6h"}),e(V,{label:"每天",value:"1d"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"保留天数"},{default:l(()=>[e(R,{modelValue:u.value.retention_days,"onUpdate:modelValue":t[4]||(t[4]=o=>u.value.retention_days=o),min:1,max:365},null,8,["modelValue"])]),_:1}),e(p,{label:"永久保存"},{default:l(()=>[e(D,{modelValue:u.value.permanent,"onUpdate:modelValue":t[5]||(t[5]=o=>u.value.permanent=o)},null,8,["modelValue"])]),_:1}),e(p,{label:"关联模型"},{default:l(()=>[e(N,{modelValue:u.value.model,"onUpdate:modelValue":t[6]||(t[6]=o=>u.value.model=o),placeholder:"选择知识提取模型"},{default:l(()=>[(C(!0),I(W,null,K(x(v).enabledModels,o=>(C(),j(V,{key:o.name,label:o.name,value:o.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),de=J(ue,[["__scopeId","data-v-ea2cc959"]]),ie={class:"rss"},ce={class:"toolbar"},me={class:"card-header"},pe=q({__name:"RSS",setup(U){const c=se(),f=w(""),m=w(!1),g=w(!1),v=w(null),k=w(null),S=w(!1),u=E(()=>f.value?c.feeds.filter(r=>r.name.toLowerCase().includes(f.value.toLowerCase())||r.url.toLowerCase().includes(f.value.toLowerCase())):c.feeds),L=r=>({full:"success",summary:"warning",failed:"danger"})[r]||"info",s=r=>({full:"完整内容",summary:"仅摘要",failed:"抓取失败"})[r]||r,t=async(r,a)=>{await c.updateFeed(r,a)?b.success("更新成功"):b.error("更新失败")},_=async r=>{await c.fetchFeedNow(r.id)?b.success("抓取任务已提交"):b.error("抓取失败")},p=r=>{v.value={...r},m.value=!0},D=async r=>{try{await ne.confirm(`确定要删除订阅 "${r.name}" 吗？`,"确认删除"),await c.deleteFeed(r.id)?b.success("删除成功"):b.error("删除失败")}catch{}},V=async r=>{b.info(`查看文章: ${r.title}`)},N=async r=>{b.info("删除文章功能开发中")},R=async r=>{let a;v.value?a=await c.updateFeed(v.value.id,r):a=await c.createFeed(r),a?(b.success(v.value?"更新成功":"创建成功"),m.value=!1,v.value=null):b.error(v.value?"更新失败":"创建失败")};return X(()=>{c.fetchFeeds()}),(r,a)=>{const F=d("el-icon"),o=d("el-button"),Q=d("el-input"),y=d("el-table-column"),O=d("el-link"),z=d("el-switch"),M=d("el-table"),P=d("el-card"),Y=d("el-tag"),B=ee("loading");return C(),I("div",ie,[T("div",ce,[e(o,{type:"primary",onClick:a[0]||(a[0]=n=>m.value=!0)},{default:l(()=>[e(F,null,{default:l(()=>[e(x(te))]),_:1}),a[5]||(a[5]=i("添加订阅 ",-1))]),_:1}),e(o,{onClick:a[1]||(a[1]=n=>g.value=!0)},{default:l(()=>[e(F,null,{default:l(()=>[e(x(le))]),_:1}),a[6]||(a[6]=i("批量导入 ",-1))]),_:1}),e(Q,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=n=>f.value=n),placeholder:"搜索名称/URL",clearable:"",style:{width:"240px","margin-left":"12px"}},{prefix:l(()=>[e(F,null,{default:l(()=>[e(x(ae))]),_:1})]),_:1},8,["modelValue"])]),A((C(),j(P,{class:"table-card"},{default:l(()=>[e(M,{data:u.value,style:{width:"100%"}},{default:l(()=>[e(y,{prop:"name",label:"名称",width:"180"}),e(y,{prop:"url",label:"URL",width:"500"},{default:l(({row:n})=>[e(O,{href:n.url,target:"_blank",type:"primary"},{default:l(()=>[i($(n.url),1)]),_:2},1032,["href"])]),_:1}),e(y,{prop:"update_interval",label:"更新频率",width:"120"}),e(y,{prop:"article_count",label:"文章数",width:"150"}),e(y,{label:"状态",width:"150"},{default:l(({row:n})=>[e(z,{modelValue:n.enabled,"onUpdate:modelValue":h=>n.enabled=h,onChange:h=>t(n.id,{enabled:h})},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(y,{label:"操作",width:"350",fixed:"right"},{default:l(({row:n})=>[e(o,{link:"",type:"primary",onClick:h=>_(n)},{default:l(()=>[...a[7]||(a[7]=[i("立即抓取",-1)])]),_:1},8,["onClick"]),e(o,{link:"",type:"primary",onClick:h=>p(n)},{default:l(()=>[...a[8]||(a[8]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(o,{link:"",type:"danger",onClick:h=>D(n)},{default:l(()=>[...a[9]||(a[9]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[B,x(c).loading]]),k.value?(C(),j(P,{key:0,class:"articles-card"},{header:l(()=>[T("div",me,[T("span",null,"文章列表 - "+$(k.value.name),1),e(o,{link:"",onClick:a[3]||(a[3]=n=>k.value=null)},{default:l(()=>[...a[10]||(a[10]=[i("关闭",-1)])]),_:1})])]),default:l(()=>[A((C(),j(M,{data:x(c).articles,style:{width:"100%"}},{default:l(()=>[e(y,{prop:"title",label:"标题"},{default:l(({row:n})=>[e(O,{onClick:h=>V(n),type:"primary"},{default:l(()=>[i($(n.title),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"published_at",label:"发布时间",width:"180"},{default:l(({row:n})=>[i($(new Date(n.published_at).toLocaleString("zh-CN")),1)]),_:1}),e(y,{prop:"fetch_status",label:"抓取状态",width:"120"},{default:l(({row:n})=>[e(Y,{type:L(n.fetch_status)},{default:l(()=>[i($(s(n.fetch_status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"content_length",label:"内容长度",width:"100"},{default:l(({row:n})=>[i($(n.content_length)+" 字符 ",1)]),_:1}),e(y,{label:"操作",width:"150",fixed:"right"},{default:l(({row:n})=>[e(o,{link:"",type:"primary",onClick:h=>V(n)},{default:l(()=>[...a[11]||(a[11]=[i("查看",-1)])]),_:1},8,["onClick"]),e(o,{link:"",type:"primary",href:n.link,target:"_blank"},{default:l(()=>[...a[12]||(a[12]=[i("原文",-1)])]),_:1},8,["href"]),e(o,{link:"",type:"danger",onClick:h=>N(n)},{default:l(()=>[...a[13]||(a[13]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,S.value]])]),_:1})):Z("",!0),e(de,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=n=>m.value=n),feed:v.value,onSubmit:R},null,8,["modelValue","feed"])])}}}),ve=J(pe,[["__scopeId","data-v-91917e2b"]]);export{ve as default};
//# sourceMappingURL=RSS-CQztfkf2.js.map
