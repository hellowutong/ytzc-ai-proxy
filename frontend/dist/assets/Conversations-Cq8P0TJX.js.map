{"version":3,"file":"Conversations-Cq8P0TJX.js","sources":["../../src/views/admin/Conversations.vue"],"sourcesContent":["<template>\n  <div class=\"conversations\">\n    <!-- Toolbar -->\n    <div class=\"toolbar\">\n      <el-input\n        v-model=\"searchQuery\"\n        placeholder=\"搜索会话内容\"\n        clearable\n        style=\"width: 300px;\"\n      >\n        <template #prefix>\n          <el-icon><Search /></el-icon>\n        </template>\n      </el-input>\n      <el-date-picker\n        v-model=\"dateRange\"\n        type=\"daterange\"\n        range-separator=\"至\"\n        start-placeholder=\"开始日期\"\n        end-placeholder=\"结束日期\"\n        style=\"margin-left: 12px;\"\n      />\n      <el-button \n        type=\"danger\" \n        :disabled=\"!hasSelection\"\n        @click=\"batchDeleteConversations\"\n        style=\"margin-left: 12px;\"\n      >\n        <el-icon><Delete /></el-icon>\n        批量删除 ({{ selectedConversations.length }})\n      </el-button>\n    </div>\n\n    <!-- Conversations Table -->\n    <el-card class=\"table-card\">\n      <el-table :data=\"filteredConversations\" style=\"width: 100%\" v-loading=\"chatStore.loading\" @selection-change=\"handleSelectionChange\">\n        <el-table-column type=\"selection\" width=\"55\" />\n        <el-table-column prop=\"id\" label=\"ID\" width=\"400\">\n          <template #default=\"{ row }\">\n            <span class=\"id-cell\">{{ row.id.slice(0, 8) }}...</span>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"model\" label=\"使用模型\" width=\"150\" />\n\n        <el-table-column label=\"消息数\" width=\"150\">\n          <template #default=\"{ row }\">\n            <el-tag>{{ row.messages?.length || 0 }}</el-tag>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"created_at\" label=\"创建时间\" width=\"230\">\n          <template #default=\"{ row }\">\n            {{ formatDateTime(row.created_at) }}\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"updated_at\" label=\"最后更新\" width=\"230\">\n          <template #default=\"{ row }\">\n            {{ formatDateTime(row.updated_at) }}\n          </template>\n        </el-table-column>\n\n        <el-table-column label=\"操作\" width=\"350\" fixed=\"right\" class-name=\"operation-column\">\n          <template #default=\"{ row }\">\n            <el-button link type=\"primary\" @click=\"viewConversation(row)\">查看</el-button>\n            <el-button link type=\"danger\" @click=\"deleteConversation(row)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <!-- Conversation Detail Dialog -->\n    <el-dialog\n      v-model=\"showDetailDialog\"\n      title=\"对话详情\"\n      width=\"800px\"\n      class=\"conversation-dialog\"\n    >\n      <div v-if=\"selectedConversation\" class=\"conversation-detail\">\n        <div class=\"detail-header\">\n          <span>模型: {{ selectedConversation.model }}</span>\n          <span>消息数: {{ selectedConversation.messages?.length || 0 }}</span>\n        </div>\n        \n        <div class=\"messages-container\">\n          <div \n            v-for=\"(msg, index) in selectedConversation.messages\" \n            :key=\"index\"\n            class=\"message-item\"\n            :class=\"msg.role\"\n          >\n            <div class=\"message-role\">{{ msg.role === 'user' ? '用户' : 'AI' }}</div>\n            <div class=\"message-content\">{{ msg.content }}</div>\n            <div v-if=\"msg.timestamp\" class=\"message-time\">\n              {{ new Date(msg.timestamp).toLocaleString('zh-CN') }}\n            </div>\n          </div>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { Search, Delete } from '@element-plus/icons-vue'\nimport { useChatStore } from '@/stores'\nimport type { Conversation } from '@/types'\n\nconst chatStore = useChatStore()\n\n// 格式化时间为本地时间显示\nconst formatDateTime = (timestamp: string) => {\n  if (!timestamp) return ''\n  try {\n    const date = new Date(timestamp)\n    return date.toLocaleString('zh-CN', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false\n    })\n  } catch (e) {\n    return timestamp\n  }\n}\n\nconst searchQuery = ref('')\nconst dateRange = ref([])\nconst showDetailDialog = ref(false)\nconst selectedConversation = ref<Conversation | null>(null)\nconst selectedConversations = ref<Conversation[]>([])\n\nconst hasSelection = computed(() => selectedConversations.value.length > 0)\n\nconst filteredConversations = computed(() => {\n  let result = chatStore.conversations\n  \n  if (searchQuery.value) {\n    result = result.filter(c => {\n      const searchLower = searchQuery.value.toLowerCase()\n      return c.id.toLowerCase().includes(searchLower) ||\n        c.messages?.some(m => m.content.toLowerCase().includes(searchLower))\n    })\n  }\n  \n  return result\n})\n\nconst viewConversation = async (conversation: Conversation) => {\n  try {\n    // 从API获取完整对话详情（包括消息）\n    const response = await fetch(`/admin/ai/v1/conversations/${conversation.id}`)\n    const result = await response.json()\n    \n    if (result.code === 200 && result.data) {\n      selectedConversation.value = result.data\n    } else {\n      // 如果API失败，使用列表中的数据\n      selectedConversation.value = conversation\n    }\n    showDetailDialog.value = true\n  } catch (error) {\n    console.error('获取对话详情失败:', error)\n    // 降级使用列表数据\n    selectedConversation.value = conversation\n    showDetailDialog.value = true\n  }\n}\n\nconst deleteConversation = async (conversation: Conversation) => {\n  try {\n    await ElMessageBox.confirm(\n      `确定要删除此对话吗？此操作不可恢复。`,\n      '确认删除',\n      { type: 'warning' }\n    )\n    \n    // 调用删除API\n    const response = await fetch(`/admin/ai/v1/conversations/${conversation.id}`, {\n      method: 'DELETE'\n    })\n    const result = await response.json()\n    \n    if (result.code === 200) {\n      // 删除成功后重新加载列表\n      await chatStore.fetchConversations()\n      ElMessage.success('删除成功')\n    } else {\n      ElMessage.error(result.message || '删除失败')\n    }\n  } catch {\n    // Cancelled\n  }\n}\n\nconst handleSelectionChange = (selection: Conversation[]) => {\n  selectedConversations.value = selection\n}\n\nconst batchDeleteConversations = async () => {\n  const count = selectedConversations.value.length\n  if (count === 0) return\n  \n  try {\n    await ElMessageBox.confirm(\n      `确定要删除选中的 ${count} 个对话吗？此操作不可恢复。`,\n      '确认批量删除',\n      { type: 'warning' }\n    )\n    \n    const ids = selectedConversations.value.map(c => c.id)\n    const response = await fetch('/admin/ai/v1/conversations/batch', {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ ids })\n    })\n    const result = await response.json()\n    \n    if (result.code === 200) {\n      await chatStore.fetchConversations()\n      ElMessage.success(result.message)\n      selectedConversations.value = []\n    } else {\n      ElMessage.error(result.message || '删除失败')\n    }\n  } catch (error) {\n    // Cancelled\n  }\n}\n\nonMounted(() => {\n  chatStore.fetchConversations()\n})\n</script>\n\n<style scoped>\n.conversations {\n  padding: 0;\n}\n\n.toolbar {\n  margin-bottom: 20px;\n  display: flex;\n  align-items: center;\n}\n\n.table-card {\n  background: #252526;\n  border: 1px solid #3C3C3C;\n}\n\n.id-cell {\n  font-family: monospace;\n  color: #858585;\n}\n\n.conversation-dialog :deep(.el-dialog) {\n  background: #252526;\n}\n\n.conversation-dialog :deep(.el-dialog__header) {\n  border-bottom: 1px solid #3C3C3C;\n  margin-right: 0;\n  padding: 20px;\n}\n\n.conversation-dialog :deep(.el-dialog__title) {\n  color: #CCCCCC;\n}\n\n.conversation-dialog :deep(.el-dialog__body) {\n  padding: 20px;\n  background: #1E1E1E;\n}\n\n.detail-header {\n  display: flex;\n  gap: 24px;\n  margin-bottom: 20px;\n  padding-bottom: 16px;\n  border-bottom: 1px solid #3C3C3C;\n  color: #858585;\n}\n\n.messages-container {\n  max-height: 500px;\n  overflow-y: auto;\n}\n\n.message-item {\n  margin-bottom: 16px;\n  padding: 12px;\n  border-radius: 8px;\n  background: #2D2D30;\n}\n\n.message-item.user {\n  background: #007ACC20;\n  border-left: 3px solid #007ACC;\n}\n\n.message-item.assistant {\n  background: #2D2D30;\n  border-left: 3px solid #3fb950;\n}\n\n.message-role {\n  font-size: 12px;\n  font-weight: 600;\n  color: #858585;\n  margin-bottom: 8px;\n  text-transform: uppercase;\n}\n\n.message-content {\n  color: #CCCCCC;\n  line-height: 1.6;\n  white-space: pre-wrap;\n}\n\n.message-time {\n  font-size: 11px;\n  color: #6e7681;\n  margin-top: 8px;\n}\n\n:deep(.el-card__header) {\n  border-bottom: 1px solid #3C3C3C;\n}\n\n:deep(.el-table) {\n  background: transparent;\n}\n\n:deep(.el-table th),\n:deep(.el-table tr) {\n  background: transparent;\n}\n\n:deep(.el-table th.el-table__cell) {\n  color: var(--text-secondary) !important;\n}\n\n/* 统一所有表头单元格背景色，包括固定列 */\n:deep(.el-table .el-table__header-wrapper th.el-table__cell),\n:deep(.el-table .el-table__fixed-header-wrapper th.el-table__cell) {\n  background-color: var(--bg-tertiary) !important;\n}\n\n:deep(.el-table--enable-row-hover .el-table__body tr:hover > td) {\n  background: var(--bg-hover);\n}\n</style>\n"],"names":["chatStore","useChatStore","formatDateTime","timestamp","searchQuery","ref","dateRange","showDetailDialog","selectedConversation","selectedConversations","hasSelection","computed","filteredConversations","result","c","searchLower","_a","m","viewConversation","conversation","error","deleteConversation","ElMessageBox","ElMessage","handleSelectionChange","selection","batchDeleteConversations","count","ids","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_input","$event","_component_el_icon","_unref","Search","_component_el_date_picker","_component_el_button","Delete","_createTextVNode","_toDisplayString","_component_el_card","_createBlock","_component_el_table","_component_el_table_column","_withCtx","row","_hoisted_3","_component_el_tag","_cache","_directive_loading","_component_el_dialog","_hoisted_4","_hoisted_5","_hoisted_6","_Fragment","msg","index","_normalizeClass","_hoisted_7","_hoisted_8","_hoisted_9"],"mappings":"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"}