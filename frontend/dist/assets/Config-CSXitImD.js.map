{"version":3,"file":"Config-CSXitImD.js","sources":["../../src/stores/config.ts","../../src/views/admin/Config.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useConfigStore = defineStore('config', () => {\n  // State\n  const config = ref<Record<string, unknown>>({})\n  const rawYaml = ref('')\n  const loading = ref(false)\n\n  // Actions\n  async function fetchConfig() {\n    loading.value = true\n    try {\n      const response = await fetch('/admin/ai/v1/config')\n      const result = await response.json()\n      if (result.code === 200) {\n        config.value = result.data\n        rawYaml.value = result.data._raw || ''\n      }\n    } catch (error) {\n      console.error('Failed to fetch config:', error)\n    } finally {\n      loading.value = false\n    }\n  }\n\n  async function updateConfig(path: string, value: unknown) {\n    try {\n      const response = await fetch('/admin/ai/v1/config', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ path, value })\n      })\n      const result = await response.json()\n      if (result.code === 200) {\n        await fetchConfig()\n        return true\n      }\n      return false\n    } catch (error) {\n      console.error('Failed to update config:', error)\n      return false\n    }\n  }\n\n  async function saveRawYaml(yaml: string) {\n    try {\n      const response = await fetch('/admin/ai/v1/config/raw', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ yaml })\n      })\n      const result = await response.json()\n      if (result.code === 200) {\n        await fetchConfig()\n        return true\n      }\n      return false\n    } catch (error) {\n      console.error('Failed to save config:', error)\n      return false\n    }\n  }\n\n  async function reloadConfig() {\n    try {\n      const response = await fetch('/admin/ai/v1/config/reload', {\n        method: 'POST'\n      })\n      const result = await response.json()\n      return result.code === 200\n    } catch (error) {\n      console.error('Failed to reload config:', error)\n      return false\n    }\n  }\n\n  function getConfigValue(path: string): unknown {\n    const keys = path.split('.')\n    let value: unknown = config.value\n    for (const key of keys) {\n      if (value && typeof value === 'object') {\n        value = (value as Record<string, unknown>)[key]\n      } else {\n        return undefined\n      }\n    }\n    return value\n  }\n\n  return {\n    config,\n    rawYaml,\n    loading,\n    fetchConfig,\n    updateConfig,\n    saveRawYaml,\n    reloadConfig,\n    getConfigValue\n  }\n})\n","<template>\n  <div class=\"config\">\n    <el-card class=\"config-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span>系统配置 (config.yml)</span>\n          <el-button-group>\n            <el-button type=\"primary\" @click=\"saveConfig\">\n              <el-icon><Check /></el-icon>保存\n            </el-button>\n            <el-button @click=\"reloadConfig\">\n              <el-icon><Refresh /></el-icon>重载\n            </el-button>\n          </el-button-group>\n        </div>\n      </template>\n      \n      <div ref=\"editorContainer\" class=\"editor-container\"></div>\n    </el-card>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport { Check, Refresh } from '@element-plus/icons-vue'\nimport * as monaco from 'monaco-editor'\nimport { useConfigStore } from '@/stores'\n\nconst configStore = useConfigStore()\nconst editorContainer = ref<HTMLDivElement>()\nlet editor: monaco.editor.IStandaloneCodeEditor | null = null\n\nconst defaultConfig = `# AI Gateway Configuration\n# 注意: 此文件通过UI编辑，请勿直接修改文件\n\nai-gateway:\n  virtual_models: {}\n  \n  databases:\n    mongodb:\n      host: localhost\n      port: 27017\n      database: ai_gateway\n    redis:\n      host: localhost\n      port: 6379\n      db: 0\n    qdrant:\n      host: localhost\n      port: 6333\n      collection: documents\n  \n  search:\n    searxng:\n      enabled: true\n      url: http://localhost:8080\n    librex:\n      enabled: true\n      url: http://localhost:8081\n    fourget:\n      enabled: true\n      url: http://localhost:8082\n`\n\nonMounted(() => {\n  if (editorContainer.value) {\n    editor = monaco.editor.create(editorContainer.value, {\n      value: configStore.rawYaml || defaultConfig,\n      language: 'yaml',\n      theme: 'vs-dark',\n      minimap: { enabled: false },\n      fontSize: 14,\n      lineNumbers: 'on',\n      roundedSelection: false,\n      scrollBeyondLastLine: false,\n      readOnly: false,\n      automaticLayout: true\n    })\n  }\n})\n\nonUnmounted(() => {\n  editor?.dispose()\n})\n\nconst saveConfig = async () => {\n  if (!editor) return\n  \n  const yaml = editor.getValue()\n  const success = await configStore.saveRawYaml(yaml)\n  \n  if (success) {\n    ElMessage.success('配置保存成功')\n  } else {\n    ElMessage.error('配置保存失败')\n  }\n}\n\nconst reloadConfig = async () => {\n  const success = await configStore.reloadConfig()\n  \n  if (success) {\n    await configStore.fetchConfig()\n    if (editor) {\n      editor.setValue(configStore.rawYaml || defaultConfig)\n    }\n    ElMessage.success('配置重载成功')\n  } else {\n    ElMessage.error('配置重载失败')\n  }\n}\n</script>\n\n<style scoped>\n.config {\n  padding: 0;\n  height: calc(100vh - 140px);\n}\n\n.config-card {\n  background: #252526;\n  border: 1px solid #3C3C3C;\n  height: 100%;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.editor-container {\n  height: calc(100vh - 240px);\n  border: 1px solid #3C3C3C;\n  border-radius: 4px;\n}\n\n:deep(.el-card__header) {\n  border-bottom: 1px solid #3C3C3C;\n  color: #CCCCCC;\n}\n\n:deep(.el-card__body) {\n  height: calc(100% - 60px);\n  padding: 12px;\n}\n</style>\n"],"names":["useConfigStore","defineStore","config","ref","rawYaml","loading","fetchConfig","result","error","updateConfig","path","value","saveRawYaml","yaml","reloadConfig","getConfigValue","keys","key","defaultConfig","configStore","editorContainer","editor","onMounted","monaco.editor","onUnmounted","saveConfig","ElMessage","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","_createElementVNode","_hoisted_2","_cache","_component_el_button_group","_component_el_button","_component_el_icon","_unref","Check","Refresh"],"mappings":"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"}