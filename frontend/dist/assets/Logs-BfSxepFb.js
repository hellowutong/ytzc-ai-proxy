import{A as J,i as f,d as I,o as M,l as y,c as F,b as t,w as l,e as L,n as p,f as N,u as U,Y,O as q,t as C,a as D,k as n,P as H,_ as E}from"./index-DgeW9NR8.js";const K=J("logs",()=>{const c=f([]),m=f(!1),o=f({level:[],module:"",start_time:"",end_time:"",keyword:""});async function d(i){m.value=!0;try{const r=new URLSearchParams;o.value.level.length&&r.append("level",o.value.level.join(",")),o.value.module&&r.append("module",o.value.module),o.value.start_time&&r.append("start_time",o.value.start_time),o.value.end_time&&r.append("end_time",o.value.end_time),o.value.keyword&&r.append("keyword",o.value.keyword);const b=await(await fetch(`/admin/ai/v1/logs/${i}?${r}`)).json();b.code===200&&(c.value=b.data.items)}catch(r){console.error("Failed to fetch logs:",r)}finally{m.value=!1}}async function u(i,r){try{const _=new URLSearchParams;_.append("format",r);const x=await(await fetch(`/admin/ai/v1/logs/${i}/export?${_}`)).blob(),R=window.URL.createObjectURL(x),s=document.createElement("a");return s.href=R,s.download=`logs_${i}_${new Date().toISOString().split("T")[0]}.${r}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(R),!0}catch(_){return console.error("Failed to export logs:",_),!1}}function v(i){o.value={...o.value,...i}}return{logs:c,loading:m,filters:o,fetchLogs:d,exportLogs:u,setFilters:v}}),Q={class:"log-viewer"},X={class:"pagination-wrapper"},Z={class:"detail-content"},ee=I({__name:"LogViewer",props:{type:{}},setup(c){const m=c,o=K(),d=f({level:[],module:"",keyword:""}),u=f([]),v=f(!1),i=f(null),r=s=>({DEBUG:"info",INFO:"success",WARNING:"warning",ERROR:"danger"})[s]||"info",_=()=>{var s,e,g,S;o.setFilters({...d.value,start_time:(e=(s=u.value)==null?void 0:s[0])==null?void 0:e.toISOString(),end_time:(S=(g=u.value)==null?void 0:g[1])==null?void 0:S.toISOString()}),o.fetchLogs(m.type)},b=()=>{d.value={level:[],module:"",keyword:""},u.value=[],_()},x=async s=>{await o.exportLogs(m.type,s)},R=s=>{i.value=s,v.value=!0};return M(()=>{o.fetchLogs(m.type)}),(s,e)=>{const g=n("el-checkbox"),S=n("el-checkbox-group"),w=n("el-form-item"),$=n("el-input"),B=n("el-date-picker"),G=n("el-icon"),k=n("el-button"),j=n("el-form"),h=n("el-card"),V=n("el-table-column"),z=n("el-tag"),A=n("el-table"),T=n("el-pagination"),P=n("el-dialog"),W=H("loading");return y(),F("div",Q,[t(h,{class:"filter-card"},{default:l(()=>[t(j,{inline:!0,model:d.value},{default:l(()=>[c.type==="system"?(y(),L(w,{key:0,label:"日志级别"},{default:l(()=>[t(S,{modelValue:d.value.level,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value.level=a)},{default:l(()=>[t(g,{label:"DEBUG"},{default:l(()=>[...e[7]||(e[7]=[p("DEBUG",-1)])]),_:1}),t(g,{label:"INFO"},{default:l(()=>[...e[8]||(e[8]=[p("INFO",-1)])]),_:1}),t(g,{label:"WARNING"},{default:l(()=>[...e[9]||(e[9]=[p("WARNING",-1)])]),_:1}),t(g,{label:"ERROR"},{default:l(()=>[...e[10]||(e[10]=[p("ERROR",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):N("",!0),c.type==="system"?(y(),L(w,{key:1,label:"模块"},{default:l(()=>[t($,{modelValue:d.value.module,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.module=a),placeholder:"模块名称",clearable:""},null,8,["modelValue"])]),_:1})):N("",!0),t(w,{label:"时间范围"},{default:l(()=>[t(B,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),_:1}),t(w,{label:"关键词"},{default:l(()=>[t($,{modelValue:d.value.keyword,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.keyword=a),placeholder:"搜索关键词",clearable:""},null,8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(k,{type:"primary",onClick:_},{default:l(()=>[t(G,null,{default:l(()=>[t(U(Y))]),_:1}),e[11]||(e[11]=p("查询",-1))]),_:1}),t(k,{onClick:b},{default:l(()=>[...e[12]||(e[12]=[p("重置",-1)])]),_:1}),t(k,{onClick:e[4]||(e[4]=a=>x("json"))},{default:l(()=>[...e[13]||(e[13]=[p("导出JSON",-1)])]),_:1}),t(k,{onClick:e[5]||(e[5]=a=>x("csv"))},{default:l(()=>[...e[14]||(e[14]=[p("导出CSV",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),q((y(),L(h,{class:"log-card"},{default:l(()=>[t(A,{data:U(o).logs,style:{width:"100%"},height:"calc(100vh - 350px)"},{default:l(()=>[t(V,{prop:"timestamp",label:"时间",width:"180"},{default:l(({row:a})=>[p(C(new Date(a.timestamp).toLocaleString("zh-CN")),1)]),_:1}),c.type==="system"?(y(),L(V,{key:0,prop:"level",label:"级别",width:"100"},{default:l(({row:a})=>[t(z,{type:r(a.level)},{default:l(()=>[p(C(a.level),1)]),_:2},1032,["type"])]),_:1})):N("",!0),c.type==="system"?(y(),L(V,{key:1,prop:"module",label:"模块",width:"150"})):N("",!0),t(V,{prop:"message",label:"消息",width:"500","show-overflow-tooltip":""}),t(V,{label:"操作",width:"200",fixed:"right","class-name":"operation-column"},{default:l(({row:a})=>[t(k,{link:"",type:"primary",onClick:oe=>R(a)},{default:l(()=>[...e[15]||(e[15]=[p("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),D("div",X,[t(T,{background:"",layout:"prev, pager, next, sizes, total",total:100,"page-sizes":[20,50,100],"default-page-size":"50"})])]),_:1})),[[W,U(o).loading]]),t(P,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),title:"日志详情",width:"600px"},{default:l(()=>[D("pre",Z,C(JSON.stringify(i.value,null,2)),1)]),_:1},8,["modelValue"])])}}}),O=E(ee,[["__scopeId","data-v-a29d1b1f"]]),te={class:"logs"},le=I({__name:"Logs",setup(c){const m=f("system");return(o,d)=>{const u=n("el-tab-pane"),v=n("el-tabs");return y(),F("div",te,[t(v,{modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=i=>m.value=i),type:"border-card",class:"logs-tabs"},{default:l(()=>[t(u,{label:"系统日志",name:"system"},{default:l(()=>[t(O,{type:"system"})]),_:1}),t(u,{label:"操作日志",name:"operation"},{default:l(()=>[t(O,{type:"operation"})]),_:1}),t(u,{label:"Skill执行日志",name:"skill"},{default:l(()=>[t(O,{type:"skill"})]),_:1})]),_:1},8,["modelValue"])])}}}),ne=E(le,[["__scopeId","data-v-9d2992c2"]]);export{ne as default};
//# sourceMappingURL=Logs-BfSxepFb.js.map
