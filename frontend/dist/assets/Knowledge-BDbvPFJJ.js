import{A as ie,i as y,d as q,e as K,w as o,j as W,k as s,l as h,b as e,u as f,a1 as re,a as i,n as p,c as J,r as Z,F as ee,_ as le,o as ce,a2 as pe,Y as me,O as fe,t as A,f as _e,E as V,$ as ve,P as be}from"./index-DgeW9NR8.js";import{u as ye}from"./models-CjJxZ9ep.js";const ge=ie("knowledge",()=>{const j=y([]),d=y(!1),g=y({embedding_model:"",base_url:"",api_key:"",cron_expression:"*/30 * * * *",cron_enabled:!1});async function k(){d.value=!0;try{const r=await(await fetch("/admin/ai/v1/knowledge/docs")).json();r.code===200&&(j.value=r.data.items)}catch(a){console.error("Failed to fetch docs:",a)}finally{d.value=!1}}async function x(a,r,T){try{const _=new FormData;return _.append("file",a),_.append("model",r),_.append("shared",String(T)),(await(await fetch("/admin/ai/v1/knowledge/docs/upload",{method:"POST",body:_})).json()).code===200}catch(_){return console.error("Failed to upload doc:",_),!1}}async function S(a){try{return(await(await fetch(`/admin/ai/v1/knowledge/docs/${a}`,{method:"DELETE"})).json()).code===200?(await k(),!0):!1}catch(r){return console.error("Failed to delete doc:",r),!1}}async function n(a){try{return(await(await fetch(`/admin/ai/v1/knowledge/docs/${a}/revectorize`,{method:"POST"})).json()).code===200}catch(r){return console.error("Failed to revectorize doc:",r),!1}}async function $(){try{const r=await(await fetch("/admin/ai/v1/knowledge/config")).json();r.code===200&&(g.value={...g.value,...r.data})}catch(a){console.error("Failed to fetch config:",a)}}async function z(){try{return(await(await fetch("/admin/ai/v1/knowledge/config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g.value)})).json()).code===200}catch(a){return console.error("Failed to save config:",a),!1}}async function C(){try{return(await(await fetch("/admin/ai/v1/knowledge/test-vector",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:g.value.embedding_model,base_url:g.value.base_url,api_key:g.value.api_key})})).json()).code===200}catch(a){return console.error("Failed to test vector connection:",a),!1}}return{docs:j,loading:d,config:g,fetchDocs:k,uploadDoc:x,deleteDoc:S,revectorizeDoc:n,fetchConfig:$,saveConfig:z,testVectorConnection:C}}),Ve={class:"dialog-footer"},we=q({__name:"DocUploadDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","upload"],setup(j,{emit:d}){const g=j,k=d,x=W({get:()=>g.modelValue,set:C=>k("update:modelValue",C)}),S=ye(),n=y({file:null,model:"",shared:!1,chunk_size:500,overlap:50}),$=C=>{n.value.file=C.raw},z=()=>{!n.value.file||!n.value.model||(k("upload",{file:n.value.file,model:n.value.model,shared:n.value.shared}),n.value={file:null,model:"",shared:!1,chunk_size:500,overlap:50})};return(C,a)=>{const r=s("el-icon"),T=s("el-upload"),_=s("el-form-item"),M=s("el-option"),N=s("el-select"),R=s("el-switch"),P=s("el-input-number"),G=s("el-form"),I=s("el-button"),Q=s("el-dialog");return h(),K(Q,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=m=>x.value=m),title:"ä¸Šä¼ æ–‡æ¡£",width:"500px"},{footer:o(()=>[i("div",Ve,[e(I,{onClick:a[4]||(a[4]=m=>x.value=!1)},{default:o(()=>[...a[8]||(a[8]=[p("å–æ¶ˆ",-1)])]),_:1}),e(I,{type:"primary",onClick:z,disabled:!n.value.file},{default:o(()=>[...a[9]||(a[9]=[p("å¼€å§‹ä¸Šä¼ ",-1)])]),_:1},8,["disabled"])])]),default:o(()=>[e(G,{model:n.value,"label-width":"120px"},{default:o(()=>[e(_,{label:"é€‰æ‹©æ–‡ä»¶"},{default:o(()=>[e(T,{ref:"uploadRef",drag:"",action:"#","auto-upload":!1,"on-change":$,limit:1,class:"upload-dragger"},{tip:o(()=>[...a[6]||(a[6]=[i("div",{class:"el-upload__tip"},"æ”¯æŒ PDF, TXT, DOC, JPG æ ¼å¼",-1)])]),default:o(()=>[e(r,{class:"el-icon--upload"},{default:o(()=>[e(f(re))]),_:1}),a[7]||(a[7]=i("div",{class:"el-upload__text"},[p(" æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ– "),i("em",null,"ç‚¹å‡»ä¸Šä¼ ")],-1))]),_:1},512)]),_:1}),e(_,{label:"ç›®æ ‡è™šæ‹Ÿæ¨¡åž‹"},{default:o(()=>[e(N,{modelValue:n.value.model,"onUpdate:modelValue":a[0]||(a[0]=m=>n.value.model=m),placeholder:"é€‰æ‹©æ¨¡åž‹"},{default:o(()=>[(h(!0),J(ee,null,Z(f(S).enabledModels,m=>(h(),K(M,{key:m.name,label:m.name,value:m.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"å…±äº«çŸ¥è¯†åº“"},{default:o(()=>[e(R,{modelValue:n.value.shared,"onUpdate:modelValue":a[1]||(a[1]=m=>n.value.shared=m)},null,8,["modelValue"])]),_:1}),e(_,{label:"åˆ†æ®µå¤§å°"},{default:o(()=>[e(P,{modelValue:n.value.chunk_size,"onUpdate:modelValue":a[2]||(a[2]=m=>n.value.chunk_size=m),min:100,max:2e3,step:100},null,8,["modelValue"])]),_:1}),e(_,{label:"é‡å å¤§å°"},{default:o(()=>[e(P,{modelValue:n.value.overlap,"onUpdate:modelValue":a[3]||(a[3]=m=>n.value.overlap=m),min:0,max:500,step:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ke=le(we,[["__scopeId","data-v-355b1cb3"]]),xe={class:"knowledge"},Ce={class:"tab-toolbar"},Ue={class:"skill-config-section"},De={class:"skill-select-row"},Se={class:"skill-select-row"},he={class:"skill-config-section"},$e={class:"skill-select-row"},Te={class:"skill-select-row"},Fe={class:"topic-section"},ze={class:"topic-section"},je={key:0,class:"retrieval-results"},Pe={class:"result-meta"},Be=q({__name:"Knowledge",setup(j){const d=ge(),g=y("docs"),k=y(""),x=y("all"),S=y(!1),n=y({extract_system_enabled:!0,extract_system_version:"v1",extract_custom_enabled:!1,extract_custom_version:"v1",topic_system_enabled:!0,topic_system_version:"v1",topic_custom_enabled:!1,topic_custom_version:"v1"}),$=y([]),z=y(""),C=y(.76),a=y([]),r=W(()=>{let u=d.docs;return k.value&&(u=u.filter(l=>l.filename.toLowerCase().includes(k.value.toLowerCase()))),x.value!=="all"&&(u=u.filter(l=>l.type===x.value)),u}),T=u=>{const l=new Date(u),L=l.getFullYear(),b=l.getMonth()+1,U=l.getDate(),c=l.getHours().toString().padStart(2,"0"),F=l.getMinutes().toString().padStart(2,"0"),w=l.getSeconds().toString().padStart(2,"0");return`${L}/${b}/${U} ${c}:${F}:${w}`},_=u=>{V.info(`é¢„è§ˆ: ${u.filename}`)},M=async u=>{await d.revectorizeDoc(u.id)?V.success("é‡æ–°å‘é‡åŒ–ä»»åŠ¡å·²æäº¤"):V.error("æ“ä½œå¤±è´¥")},N=async u=>{try{await ve.confirm(`ç¡®å®šè¦åˆ é™¤ "${u.filename}" å—ï¼Ÿ`,"ç¡®è®¤åˆ é™¤"),await d.deleteDoc(u.id)?V.success("åˆ é™¤æˆåŠŸ"):V.error("åˆ é™¤å¤±è´¥")}catch{}},R=async()=>{await d.testVectorConnection()?V.success("å‘é‡æœåŠ¡è¿žæŽ¥æˆåŠŸ"):V.error("å‘é‡æœåŠ¡è¿žæŽ¥å¤±è´¥")},P=async()=>{await d.saveConfig()?V.success("é…ç½®ä¿å­˜æˆåŠŸ"):V.error("é…ç½®ä¿å­˜å¤±è´¥")},G=()=>{V.success("Skillé…ç½®ä¿å­˜æˆåŠŸ")},I=()=>{$.value.push({name:"",patterns:[]})},Q=u=>{$.value.splice(u,1)},m=()=>{a.value=[{filename:"ç¤ºä¾‹æ–‡æ¡£1.pdf",content:"è¿™æ˜¯æ£€ç´¢åˆ°çš„å†…å®¹ç‰‡æ®µ...",score:.89},{filename:"ç¤ºä¾‹æ–‡æ¡£2.txt",content:"å¦ä¸€ä¸ªåŒ¹é…çš„å†…å®¹ç‰‡æ®µ...",score:.76}]},oe=async u=>{await d.uploadDoc(u.file,u.model,u.shared)?(V.success("æ–‡æ¡£ä¸Šä¼ æˆåŠŸ"),S.value=!1):V.error("æ–‡æ¡£ä¸Šä¼ å¤±è´¥")};return ce(()=>{d.fetchDocs(),d.fetchConfig()}),(u,l)=>{const L=s("el-icon"),b=s("el-button"),U=s("el-input"),c=s("el-option"),F=s("el-select"),w=s("el-table-column"),X=s("el-tag"),Y=s("el-table"),B=s("el-tab-pane"),v=s("el-form-item"),E=s("el-form"),O=s("el-switch"),H=s("el-divider"),te=s("el-tag-input"),ae=s("el-slider"),ne=s("el-collapse-item"),se=s("el-collapse"),de=s("el-tabs"),ue=be("loading");return h(),J("div",xe,[e(de,{modelValue:g.value,"onUpdate:modelValue":l[18]||(l[18]=t=>g.value=t),type:"border-card",class:"knowledge-tabs"},{default:o(()=>[e(B,{label:"æ–‡æ¡£åˆ—è¡¨",name:"docs"},{default:o(()=>[i("div",Ce,[e(b,{type:"primary",onClick:l[0]||(l[0]=t=>S.value=!0)},{default:o(()=>[e(L,null,{default:o(()=>[e(f(pe))]),_:1}),l[20]||(l[20]=p("ä¸Šä¼ æ–‡æ¡£ ",-1))]),_:1}),e(U,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=t=>k.value=t),placeholder:"æœç´¢æ–‡ä»¶å/å†…å®¹",clearable:"",style:{width:"240px","margin-left":"12px"}},{prefix:o(()=>[e(L,null,{default:o(()=>[e(f(me))]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=t=>x.value=t),placeholder:"ç±»åž‹ç­›é€‰",style:{width:"120px","margin-left":"12px"}},{default:o(()=>[e(c,{label:"å…¨éƒ¨",value:"all"}),e(c,{label:"PDF",value:"pdf"}),e(c,{label:"TXT",value:"txt"}),e(c,{label:"DOC",value:"doc"}),e(c,{label:"JPG",value:"jpg"})]),_:1},8,["modelValue"])]),fe((h(),K(Y,{data:r.value,style:{width:"100%"}},{default:o(()=>[e(w,{prop:"filename",label:"æ–‡ä»¶å",width:"300"}),e(w,{prop:"type",label:"ç±»åž‹",width:"100"},{default:o(({row:t})=>[e(X,null,{default:o(()=>[p(A(t.type.toUpperCase()),1)]),_:2},1024)]),_:1}),e(w,{prop:"source",label:"æ¥æº",width:"120"}),e(w,{prop:"vectorized",label:"å‘é‡åŒ–çŠ¶æ€",width:"135"},{default:o(({row:t})=>[e(X,{type:t.vectorized?"success":"warning"},{default:o(()=>[p(A(t.vectorized?"å·²å‘é‡":"å¾…å¤„ç†"),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"created_at",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:o(({row:t})=>[p(A(T(t.created_at)),1)]),_:1}),e(w,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(({row:t})=>[e(b,{link:"",type:"primary",onClick:D=>_(t)},{default:o(()=>[...l[21]||(l[21]=[p("é¢„è§ˆ",-1)])]),_:1},8,["onClick"]),e(b,{link:"",type:"primary",onClick:D=>M(t)},{default:o(()=>[...l[22]||(l[22]=[p("é‡æ–°å‘é‡åŒ–",-1)])]),_:1},8,["onClick"]),e(b,{link:"",type:"danger",onClick:D=>N(t)},{default:o(()=>[...l[23]||(l[23]=[p("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,f(d).loading]])]),_:1}),e(B,{label:"å‘é‡é…ç½®",name:"vector"},{default:o(()=>[e(E,{"label-width":"140px",class:"config-form"},{default:o(()=>[e(v,{label:"Embeddingæ¨¡åž‹"},{default:o(()=>[e(U,{modelValue:f(d).config.embedding_model,"onUpdate:modelValue":l[3]||(l[3]=t=>f(d).config.embedding_model=t),placeholder:"å¦‚: BAAI/bge-m3"},null,8,["modelValue"])]),_:1}),e(v,{label:"Base URL"},{default:o(()=>[e(U,{modelValue:f(d).config.base_url,"onUpdate:modelValue":l[4]||(l[4]=t=>f(d).config.base_url=t),placeholder:"APIåœ°å€"},null,8,["modelValue"])]),_:1}),e(v,{label:"API Key"},{default:o(()=>[e(U,{modelValue:f(d).config.api_key,"onUpdate:modelValue":l[5]||(l[5]=t=>f(d).config.api_key=t),type:"password",placeholder:"å¯†é’¥"},null,8,["modelValue"])]),_:1}),e(v,null,{default:o(()=>[e(b,{onClick:R},{default:o(()=>[...l[24]||(l[24]=[p("ðŸ§ª æµ‹è¯•è¿žæŽ¥",-1)])]),_:1}),e(b,{type:"primary",onClick:P},{default:o(()=>[...l[25]||(l[25]=[p("ðŸ’¾ ä¿å­˜é…ç½®",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{label:"å®šæ—¶å™¨",name:"cron"},{default:o(()=>[e(E,{"label-width":"140px",class:"config-form"},{default:o(()=>[e(v,{label:"Cronè¡¨è¾¾å¼"},{default:o(()=>[e(U,{modelValue:f(d).config.cron_expression,"onUpdate:modelValue":l[6]||(l[6]=t=>f(d).config.cron_expression=t),placeholder:"å¦‚: */30 * * * *"},null,8,["modelValue"]),l[26]||(l[26]=i("div",{class:"form-tip"},"æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡",-1))]),_:1}),e(v,{label:"å¯ç”¨å®šæ—¶æŠ“å–"},{default:o(()=>[e(O,{modelValue:f(d).config.cron_enabled,"onUpdate:modelValue":l[7]||(l[7]=t=>f(d).config.cron_enabled=t)},null,8,["modelValue"])]),_:1}),e(v,null,{default:o(()=>[e(b,{type:"primary",onClick:P},{default:o(()=>[...l[27]||(l[27]=[p("ðŸ’¾ ä¿å­˜é…ç½®",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{label:"Skillé…ç½®",name:"skills"},{default:o(()=>[i("div",Ue,[l[28]||(l[28]=i("h4",null,"çŸ¥è¯†æå–Skill",-1)),e(E,{"label-width":"200px"},{default:o(()=>[e(v,{label:"ç³»ç»Ÿé»˜è®¤Skill"},{default:o(()=>[i("div",De,[e(F,{modelValue:n.value.extract_system_version,"onUpdate:modelValue":l[8]||(l[8]=t=>n.value.extract_system_version=t),style:{width:"120px"}},{default:o(()=>[e(c,{label:"v1",value:"v1"}),e(c,{label:"v2",value:"v2"}),e(c,{label:"v3",value:"v3"})]),_:1},8,["modelValue"]),e(O,{modelValue:n.value.extract_system_enabled,"onUpdate:modelValue":l[9]||(l[9]=t=>n.value.extract_system_enabled=t),class:"ml-2"},null,8,["modelValue"])])]),_:1}),e(v,{label:"è‡ªå®šä¹‰Skill"},{default:o(()=>[i("div",Se,[e(F,{modelValue:n.value.extract_custom_version,"onUpdate:modelValue":l[10]||(l[10]=t=>n.value.extract_custom_version=t),style:{width:"120px"}},{default:o(()=>[e(c,{label:"v1",value:"v1"}),e(c,{label:"v2",value:"v2"}),e(c,{label:"v3",value:"v3"})]),_:1},8,["modelValue"]),e(O,{modelValue:n.value.extract_custom_enabled,"onUpdate:modelValue":l[11]||(l[11]=t=>n.value.extract_custom_enabled=t),class:"ml-2"},null,8,["modelValue"])])]),_:1})]),_:1})]),e(H),i("div",he,[l[29]||(l[29]=i("h4",null,"ä¸»é¢˜åˆ†ç±»Skill",-1)),e(E,{"label-width":"200px"},{default:o(()=>[e(v,{label:"ç³»ç»Ÿé»˜è®¤Skill"},{default:o(()=>[i("div",$e,[e(F,{modelValue:n.value.topic_system_version,"onUpdate:modelValue":l[12]||(l[12]=t=>n.value.topic_system_version=t),style:{width:"120px"}},{default:o(()=>[e(c,{label:"v1",value:"v1"}),e(c,{label:"v2",value:"v2"}),e(c,{label:"v3",value:"v3"})]),_:1},8,["modelValue"]),e(O,{modelValue:n.value.topic_system_enabled,"onUpdate:modelValue":l[13]||(l[13]=t=>n.value.topic_system_enabled=t),class:"ml-2"},null,8,["modelValue"])])]),_:1}),e(v,{label:"è‡ªå®šä¹‰Skill"},{default:o(()=>[i("div",Te,[e(F,{modelValue:n.value.topic_custom_version,"onUpdate:modelValue":l[14]||(l[14]=t=>n.value.topic_custom_version=t),style:{width:"120px"}},{default:o(()=>[e(c,{label:"v1",value:"v1"}),e(c,{label:"v2",value:"v2"}),e(c,{label:"v3",value:"v3"})]),_:1},8,["modelValue"]),e(O,{modelValue:n.value.topic_custom_enabled,"onUpdate:modelValue":l[15]||(l[15]=t=>n.value.topic_custom_enabled=t),class:"ml-2"},null,8,["modelValue"])])]),_:1})]),_:1})]),e(b,{type:"primary",onClick:G},{default:o(()=>[...l[30]||(l[30]=[p("ðŸ’¾ ä¿å­˜é…ç½®",-1)])]),_:1})]),_:1}),e(B,{label:"ä¸»é¢˜åˆ†ç±»",name:"topics"},{default:o(()=>[i("div",Fe,[l[33]||(l[33]=i("h4",null,"è‡ªåŠ¨åˆ†ç±»",-1)),e(b,{type:"primary",onClick:I},{default:o(()=>[...l[31]||(l[31]=[p("+ æ·»åŠ åˆ†ç±»",-1)])]),_:1}),e(Y,{data:$.value,style:{width:"100%","margin-top":"16px"}},{default:o(()=>[e(w,{prop:"name",label:"ä¸»é¢˜å"},{default:o(({row:t})=>[e(U,{modelValue:t.name,"onUpdate:modelValue":D=>t.name=D,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{prop:"patterns",label:"æ¨¡å¼"},{default:o(({row:t})=>[e(te,{modelValue:t.patterns,"onUpdate:modelValue":D=>t.patterns=D,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{width:"80"},{default:o(({$index:t})=>[e(b,{link:"",type:"danger",onClick:D=>Q(t)},{default:o(()=>[...l[32]||(l[32]=[p("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),e(H),i("div",ze,[l[36]||(l[36]=i("h4",null,"å‘é‡æ£€ç´¢æµ‹è¯•",-1)),e(E,{"label-width":"100px"},{default:o(()=>[e(v,{label:"æµ‹è¯•æŸ¥è¯¢"},{default:o(()=>[e(U,{modelValue:z.value,"onUpdate:modelValue":l[16]||(l[16]=t=>z.value=t),type:"textarea",rows:"3",placeholder:"è¾“å…¥æµ‹è¯•é—®é¢˜"},null,8,["modelValue"])]),_:1}),e(v,{label:"ç›¸ä¼¼åº¦é˜ˆå€¼"},{default:o(()=>[e(ae,{modelValue:C.value,"onUpdate:modelValue":l[17]||(l[17]=t=>C.value=t),min:0,max:1,step:.01,"show-input":""},null,8,["modelValue"])]),_:1}),e(v,null,{default:o(()=>[e(b,{type:"primary",onClick:m},{default:o(()=>[...l[34]||(l[34]=[p("ðŸ” æ£€ç´¢",-1)])]),_:1})]),_:1})]),_:1}),a.value.length?(h(),J("div",je,[l[35]||(l[35]=i("h5",null,"æ£€ç´¢ç»“æžœ",-1)),e(se,null,{default:o(()=>[(h(!0),J(ee,null,Z(a.value,(t,D)=>(h(),K(ne,{key:D,title:t.filename},{default:o(()=>[i("p",null,A(t.content),1),i("div",Pe,"ç›¸ä¼¼åº¦: "+A((t.score*100).toFixed(2))+"%",1)]),_:2},1032,["title"]))),128))]),_:1})])):_e("",!0)])]),_:1})]),_:1},8,["modelValue"]),e(ke,{modelValue:S.value,"onUpdate:modelValue":l[19]||(l[19]=t=>S.value=t),onUpload:oe},null,8,["modelValue"])])}}}),Ae=le(Be,[["__scopeId","data-v-1dc79bf2"]]);export{Ae as default};
//# sourceMappingURL=Knowledge-BDbvPFJJ.js.map
