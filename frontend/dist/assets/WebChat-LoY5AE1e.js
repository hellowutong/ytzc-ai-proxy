import{d as ne,o as oe,c as v,a as o,b as s,w as l,F as V,r as T,u as a,e as x,f as E,g as K,h as N,i as S,j as le,k as m,l as u,m as ae,p as ie,n as _,q as L,t as C,s as re,v as de,x as ue,y as ce,E as p,z as me,_ as ve}from"./index-DgeW9NR8.js";import{u as _e}from"./models-CjJxZ9ep.js";import{u as pe}from"./chat-CXlrgbd5.js";const fe={class:"webchat"},ge={class:"sidebar-left"},we={class:"sidebar-header"},Ce={class:"conversation-list"},be=["onClick"],he={class:"conv-info"},ke={class:"conv-title"},ye={class:"conv-preview"},Ve={class:"sidebar-footer"},xe={class:"chat-main"},Se={class:"chat-header"},Me={class:"model-selector"},Ue={class:"header-actions"},$e={key:0,class:"empty-state"},Te={class:"message-avatar"},Ee={class:"message-content"},Ne={class:"message-bubble"},ze={key:0,class:"message-time"},Be={key:0,class:"message assistant"},je={class:"input-area"},Fe={class:"input-wrapper"},Ie={class:"input-actions"},De={class:"settings-content"},Ke={class:"settings-actions"},Le=ne({__name:"WebChat",setup(Ge){const G=ae(),t=pe(),M=_e(),c=S(""),f=S(""),h=S(!1),k=S(),z=le(()=>{if(!c.value)return null;const i=M.models.find(e=>e.name===c.value);return i?`${i.current==="small"?"å°æ¨¡å‹":"å¤§æ¨¡å‹"}: ${i[i.current].model}`:null}),P=i=>{var r;const e=(r=i.messages)==null?void 0:r[i.messages.length-1];return e?e.content.slice(0,30)+"...":"æ— æ¶ˆæ¯"},W=async()=>{if(!c.value){p.warning("è¯·å…ˆé€‰æ‹©æ¨¡å‹");return}await t.createConversation(c.value),j()},q=async i=>{try{const r=await(await fetch(`/admin/ai/v1/conversations/${i.id}`)).json();if(r.code===200){const d=r.data;t.setCurrentConversation(d),c.value=d.model;const g=t.conversations.findIndex(U=>U.id===i.id);g!==-1&&(t.conversations[g]={...t.conversations[g],...d})}else t.setCurrentConversation(i),c.value=i.model,p.warning("è·å–å¯¹è¯è¯¦æƒ…å¤±è´¥")}catch(e){console.error("Failed to fetch conversation details:",e),t.setCurrentConversation(i),c.value=i.model,p.error("è·å–å¯¹è¯è¯¦æƒ…å¤±è´¥")}},A=async i=>{var e;try{const d=await(await fetch(`/admin/ai/v1/conversations/${i.id}`,{method:"DELETE"})).json();d.code===200?(t.conversations=t.conversations.filter(g=>g.id!==i.id),((e=t.currentConversation)==null?void 0:e.id)===i.id&&(t.currentConversation=null),p.success("å¯¹è¯å·²åˆ é™¤")):p.error(d.message||"åˆ é™¤å¤±è´¥")}catch(r){console.error("Failed to delete conversation:",r),p.error("åˆ é™¤å¤±è´¥")}},B=async()=>{if(!f.value.trim()||!c.value)return;const i=f.value;if(f.value="",!t.currentConversation&&(!await t.createConversation(c.value)||!t.currentConversation)){console.error("åˆ›å»ºå¯¹è¯å¤±è´¥"),p.error("åˆ›å»ºå¯¹è¯å¤±è´¥ï¼Œè¯·é‡è¯•");return}await t.sendMessage(i,c.value),j()},H=()=>{t.stopStreaming()},R=()=>{t.clearCurrentConversation()},J=()=>{window.opener?window.close():G.push("/admin/dashboard")},O=()=>{p.success("è®¾ç½®å·²ä¿å­˜"),h.value=!1},Q=()=>{t.updateSettings({temperature:.7,max_tokens:2e3,stream:!0,knowledge_enabled:!0,web_search_enabled:!1,code_highlight:!0,show_thinking:!1}),p.success("è®¾ç½®å·²é‡ç½®")},j=()=>{me(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})};return oe(async()=>{var i;if(M.fetchModels(),await t.fetchConversations(),(i=t.currentConversation)!=null&&i.id)try{const r=await(await fetch(`/admin/ai/v1/conversations/${t.currentConversation.id}`)).json();r.code===200&&r.data&&t.setCurrentConversation(r.data)}catch(e){console.error("åŠ è½½å®Œæ•´å¯¹è¯å¤±è´¥:",e)}}),(i,e)=>{var I,D;const r=m("el-icon"),d=m("el-button"),g=m("el-option"),U=m("el-select"),X=m("el-tag"),Y=m("el-input"),Z=m("el-slider"),w=m("el-form-item"),ee=m("el-input-number"),b=m("el-switch"),$=m("el-form"),F=m("el-divider"),te=m("el-drawer");return u(),v("div",fe,[o("aside",ge,[o("div",we,[s(d,{type:"primary",onClick:W,class:"new-chat-btn"},{default:l(()=>[s(r,null,{default:l(()=>[s(a(ie))]),_:1}),e[12]||(e[12]=_("æ–°å»ºå¯¹è¯ ",-1))]),_:1})]),o("div",Ce,[(u(!0),v(V,null,T(a(t).conversations,n=>{var y;return u(),v("div",{key:n.id,class:L(["conversation-item",{active:((y=a(t).currentConversation)==null?void 0:y.id)===n.id}]),onClick:se=>q(n)},[o("div",he,[o("div",ke,"å¯¹è¯ "+C(n.id.slice(0,8)),1),o("div",ye,C(P(n)),1)]),s(d,{link:"",class:"delete-btn",onClick:N(se=>A(n),["stop"])},{default:l(()=>[s(r,null,{default:l(()=>[s(a(re))]),_:1})]),_:1},8,["onClick"])],10,be)}),128))]),o("div",Ve,[s(d,{link:"",onClick:e[0]||(e[0]=n=>h.value=!0)},{default:l(()=>[s(r,null,{default:l(()=>[s(a(de))]),_:1}),e[13]||(e[13]=_("è®¾ç½® ",-1))]),_:1})])]),o("div",xe,[o("header",Se,[o("div",Me,[e[14]||(e[14]=o("span",null,"æ¨¡å‹:",-1)),s(U,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=n=>c.value=n),placeholder:"é€‰æ‹©æ¨¡å‹",style:{width:"160px"}},{default:l(()=>[(u(!0),v(V,null,T(a(M).enabledModels,n=>(u(),x(g,{key:n.name,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",Ue,[z.value?(u(),x(X,{key:0},{default:l(()=>[_(C(z.value),1)]),_:1})):E("",!0),s(d,{onClick:R},{default:l(()=>[...e[15]||(e[15]=[_("æ¸…ç©ºå¯¹è¯",-1)])]),_:1}),s(d,{onClick:J},{default:l(()=>[...e[16]||(e[16]=[_("å…³é—­é¡µé¢",-1)])]),_:1})])]),o("div",{class:"messages-area",ref_key:"messagesContainer",ref:k},[(D=(I=a(t).currentConversation)==null?void 0:I.messages)!=null&&D.length?(u(),v(V,{key:1},[(u(!0),v(V,null,T(a(t).currentConversation.messages,(n,y)=>(u(),v("div",{key:y,class:L(["message",n.role])},[o("div",Te,C(n.role==="user"?"ğŸ‘¤":"ğŸ¤–"),1),o("div",Ee,[o("div",Ne,C(n.content),1),n.timestamp?(u(),v("div",ze,C(new Date(n.timestamp).toLocaleTimeString("zh-CN")),1)):E("",!0)])],2))),128)),a(t).isStreaming?(u(),v("div",Be,[...e[18]||(e[18]=[o("div",{class:"message-avatar"},"ğŸ¤–",-1),o("div",{class:"message-content"},[o("div",{class:"typing-indicator"},[o("span"),o("span"),o("span")])],-1)])])):E("",!0)],64)):(u(),v("div",$e,[...e[17]||(e[17]=[o("div",{class:"welcome-text"},[o("h2",null,"ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ AI Gateway"),o("p",null,"é€‰æ‹©ä¸€ä¸ªæ¨¡å‹å¼€å§‹å¯¹è¯")],-1)])]))],512),o("div",je,[o("div",Fe,[s(Y,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value=n),type:"textarea",rows:3,placeholder:"è¾“å…¥æ¶ˆæ¯... (Shift+Enteræ¢è¡Œ)",onKeydown:[e[3]||(e[3]=K(N(n=>f.value+="\\n",["shift","prevent"]),["enter"])),K(N(B,["exact","prevent"]),["enter"])],resize:"none"},null,8,["modelValue","onKeydown"]),o("div",Ie,[a(t).isStreaming?(u(),x(d,{key:0,type:"danger",onClick:H},{default:l(()=>[s(r,null,{default:l(()=>[s(a(ue))]),_:1}),e[19]||(e[19]=_("åœæ­¢ ",-1))]),_:1})):(u(),x(d,{key:1,type:"primary",disabled:!f.value.trim()||!c.value,onClick:B},{default:l(()=>[s(r,null,{default:l(()=>[s(a(ce))]),_:1}),e[20]||(e[20]=_("å‘é€ ",-1))]),_:1},8,["disabled"]))])])])]),s(te,{modelValue:h.value,"onUpdate:modelValue":e[11]||(e[11]=n=>h.value=n),title:"âš™ï¸ è®¾ç½®",direction:"rtl",size:"360px"},{default:l(()=>[o("div",De,[e[23]||(e[23]=o("h4",null,"æ¨¡å‹å‚æ•°",-1)),s($,{"label-width":"120px"},{default:l(()=>[s(w,{label:"Temperature"},{default:l(()=>[s(Z,{modelValue:a(t).settings.temperature,"onUpdate:modelValue":e[4]||(e[4]=n=>a(t).settings.temperature=n),min:0,max:2,step:.1,"show-input":""},null,8,["modelValue"])]),_:1}),s(w,{label:"Max Tokens"},{default:l(()=>[s(ee,{modelValue:a(t).settings.max_tokens,"onUpdate:modelValue":e[5]||(e[5]=n=>a(t).settings.max_tokens=n),min:100,max:8e3,step:100},null,8,["modelValue"])]),_:1}),s(w,{label:"æµå¼å“åº”"},{default:l(()=>[s(b,{modelValue:a(t).settings.stream,"onUpdate:modelValue":e[6]||(e[6]=n=>a(t).settings.stream=n)},null,8,["modelValue"])]),_:1})]),_:1}),s(F),e[24]||(e[24]=o("h4",null,"åŠŸèƒ½å¼€å…³",-1)),s($,{"label-width":"120px"},{default:l(()=>[s(w,{label:"çŸ¥è¯†åº“æ£€ç´¢"},{default:l(()=>[s(b,{modelValue:a(t).settings.knowledge_enabled,"onUpdate:modelValue":e[7]||(e[7]=n=>a(t).settings.knowledge_enabled=n)},null,8,["modelValue"])]),_:1}),s(w,{label:"è”ç½‘æœç´¢"},{default:l(()=>[s(b,{modelValue:a(t).settings.web_search_enabled,"onUpdate:modelValue":e[8]||(e[8]=n=>a(t).settings.web_search_enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),s(F),e[25]||(e[25]=o("h4",null,"æ˜¾ç¤ºè®¾ç½®",-1)),s($,{"label-width":"120px"},{default:l(()=>[s(w,{label:"ä»£ç é«˜äº®"},{default:l(()=>[s(b,{modelValue:a(t).settings.code_highlight,"onUpdate:modelValue":e[9]||(e[9]=n=>a(t).settings.code_highlight=n)},null,8,["modelValue"])]),_:1}),s(w,{label:"æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹"},{default:l(()=>[s(b,{modelValue:a(t).settings.show_thinking,"onUpdate:modelValue":e[10]||(e[10]=n=>a(t).settings.show_thinking=n)},null,8,["modelValue"])]),_:1})]),_:1}),o("div",Ke,[s(d,{type:"primary",onClick:O},{default:l(()=>[...e[21]||(e[21]=[_("ä¿å­˜",-1)])]),_:1}),s(d,{onClick:Q},{default:l(()=>[...e[22]||(e[22]=[_("é‡ç½®ä¸ºé»˜è®¤",-1)])]),_:1})])])]),_:1},8,["modelValue"])])}}}),Ae=ve(Le,[["__scopeId","data-v-d351202a"]]);export{Ae as default};
//# sourceMappingURL=WebChat-LoY5AE1e.js.map
